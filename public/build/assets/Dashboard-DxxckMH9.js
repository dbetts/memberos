import{c as L,r as n,j as s}from"./app-C2cRDrk6.js";import{a as c,C as h,T as g}from"./client-C_H5CMFT.js";import{B as o}from"./Badge-CbVuks5E.js";import{B as M}from"./Button-Dyjvqw8_.js";import{L as R}from"./ChartCard-B5ERIz3S.js";/* empty css            *//**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=L("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),F=[{month:"Jan",retained:93,joins:380,churn:7},{month:"Feb",retained:94,joins:410,churn:6},{month:"Mar",retained:94,joins:422,churn:6},{month:"Apr",retained:95,joins:450,churn:5},{month:"May",retained:95,joins:470,churn:5},{month:"Jun",retained:97,joins:520,churn:3}],I=[{id:"C-101",name:"Power Cycle",start:"06:00",capacity:24,booked:23,waitlist:2},{id:"C-225",name:"HIIT 45",start:"07:00",capacity:18,booked:16,waitlist:0},{id:"C-338",name:"Reformer Pilates",start:"08:00",capacity:12,booked:12,waitlist:4},{id:"C-441",name:"Strength Lab",start:"09:00",capacity:20,booked:18,waitlist:1}];function T(){const[y,b]=n.useState([]),[f,k]=n.useState([]),[v,m]=n.useState(!0),[u,d]=n.useState(null),[a,_]=n.useState(null),[r,x]=n.useState({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""}),j=n.useCallback(async()=>{const e=new URLSearchParams;Object.entries(r).forEach(([S,p])=>{p&&e.append(S,p)});const l=e.toString()?`?${e.toString()}`:"",[t,C]=await Promise.all([c(`/dashboard/kpis${l}`),c("/retention/at-risk?limit=8")]);b(t.data),k(C.data)},[r]);n.useEffect(()=>{let e=!0;async function l(){try{const t=await c("/dashboard/filters");e&&_(t.data)}catch(t){if(!e)return;d(t instanceof Error?t.message:"Failed to load dashboard")}}return l(),()=>{e=!1}},[]),n.useEffect(()=>{let e=!0;async function l(){try{m(!0),await j(),e&&d(null)}catch(t){if(!e)return;d(t instanceof Error?t.message:"Failed to load dashboard")}finally{e&&m(!1)}}return l(),()=>{e=!1}},[j]);const N=n.useMemo(()=>e=>e>=70?"High":e>=40?"Med":"Low",[]);function i(e,l){x(t=>({...t,[e]:l}))}function w(){x({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""})}return s.jsxs("div",{className:"grid gap-6",children:[s.jsxs(h,{title:"Segments",subtitle:"Filter KPIs by cohort",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[s.jsxs("label",{className:"text-xs text-slate-500",children:["Location",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.location_id,onChange:e=>i("location_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.locations.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Class type",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.class_type,onChange:e=>i("class_type",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.class_types.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Plan",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.plan_id,onChange:e=>i("plan_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.plans.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Instructor",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.instructor_id,onChange:e=>i("instructor_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.instructors.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Lead source",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.source,onChange:e=>i("source",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.sources.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Join month",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:r.join_month,onChange:e=>i("join_month",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.join_months.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(M,{type:"button",onClick:w,children:"Clear filters"})})]}),s.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:y.map(e=>s.jsxs("div",{className:"card p-5",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-slate-500 text-sm",children:e.label}),s.jsx("span",{title:e.delta?`${e.delta} ${e.good?"improvement":"decline"}`:"",children:s.jsx(A,{size:14,className:"text-slate-400"})})]}),s.jsxs("div",{className:"mt-2 flex items-end justify-between",children:[s.jsx("div",{className:"text-2xl font-semibold",children:e.value}),e.delta&&s.jsxs(o,{tone:e.good?"good":"bad",children:[e.delta," ",e.good?"vs last mo":"worse"]})]})]},e.key))}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[s.jsx("div",{className:"xl:col-span-2",children:s.jsx(R,{data:F})}),s.jsx(h,{title:"Today's classes",subtitle:"Capacity & waitlist",children:s.jsx(g,{cols:[{key:"name",header:"Class"},{key:"start",header:"Start"},{key:"capacity",header:"Capacity"},{key:"booked",header:"Booked",render:(e,l)=>s.jsxs("span",{children:[e," / ",l.capacity]})},{key:"waitlist",header:"Waitlist",render:e=>e>0?s.jsx(o,{tone:"warn",children:e}):s.jsx("span",{className:"text-slate-500",children:"—"})}],rows:I})})]}),s.jsxs(h,{title:"At‑risk members",subtitle:"Churn risk & reasons",children:[u&&s.jsx("div",{className:"text-sm text-red-600 mb-3",children:u}),s.jsx(g,{cols:[{key:"name",header:"Name"},{key:"lastCheckIn",header:"Last check‑in"},{key:"risk",header:"Risk",render:e=>e==="High"?s.jsx(o,{tone:"bad",children:"High"}):e==="Med"?s.jsx(o,{tone:"warn",children:"Med"}):s.jsx(o,{tone:"good",children:"Low"})},{key:"reason",header:"Why"}],rows:f.map(e=>{var l,t;return{id:e.member_id,name:e.member.name,lastCheckIn:e.member.last_check_in_days!==null?`${e.member.last_check_in_days} days`:"No check-ins",risk:N(e.score),reason:((t=(l=e.reasons)==null?void 0:l[0])==null?void 0:t.detail)??""}}),loading:v})]})]})}export{T as default};
