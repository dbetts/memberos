import{c as E,r as u,j as t,e as hs,S as fs,f as bs,a as $,i as Ie}from"./app-D8iT2tzN.js";import{C as vt}from"./Card-Dbv6updy.js";import{B as O}from"./Button-CbkwZXlE.js";import{M as Le}from"./Modal-DpO69hRm.js";import{T as D}from"./TextInput-DSljf_rU.js";import{S as P}from"./SelectInput-DSfljg_A.js";/* empty css            *//**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=E("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=E("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=E("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=E("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=E("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=E("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=E("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=E("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=E("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=E("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=E("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function Cs({content:r,children:a}){const c=u.useRef(null),[d,b]=u.useState(!1),[v,w]=u.useState({top:0,left:0});return u.useEffect(()=>{function y(){if(!d||!c.current)return;const M=c.current.getBoundingClientRect();w({top:M.top+window.scrollY-8,left:M.left+M.width/2+window.scrollX})}return d&&(y(),window.addEventListener("scroll",y,!0),window.addEventListener("resize",y)),()=>{window.removeEventListener("scroll",y,!0),window.removeEventListener("resize",y)}},[d]),r?t.jsxs("span",{ref:c,className:"inline-flex",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:[a,d&&hs.createPortal(t.jsx("div",{className:"pointer-events-none absolute z-50 rounded-lg border border-slate-200 bg-white px-3 py-2 text-[11px] text-slate-700 shadow-2xl",style:{position:"absolute",top:v.top,left:v.left,transform:"translate(-50%, -100%)"},children:r}),document.body)]}):t.jsx("span",{children:a})}const Ts=[{value:"calories",label:"Calories"},{value:"meters",label:"Meters / distance"},{value:"reps",label:"Reps"},{value:"weight",label:"Weight / load"}],wt=[{value:"load",label:"Load"},{value:"rpe",label:"RPE"},{value:"one_rm_percent",label:"1RM %"},{value:"rir",label:"RIR"}],Es=[{value:"",label:"Select format"},{value:"for_time",label:"For time"},{value:"amrap",label:"AMRAP"},{value:"emom",label:"EMOM"},{value:"chipper",label:"Chipper"},{value:"ladder",label:"Ladder"}],W=[{value:"time",label:"Time"},{value:"rounds_reps",label:"Rounds + Reps"},{value:"reps",label:"Reps"},{value:"load",label:"Load"},{value:"calories",label:"Calories"},{value:"meters",label:"Meters"}],Ds=[...wt,...W],Fe=[{value:"everyone",label:"Everyone"},{value:"coaches",label:"Coaches"},{value:"programmers",label:"Programmers"}],Ms=Array.from({length:30},(r,a)=>a+1);function kt(){return Math.random().toString(36).slice(2,9)}function K(r="",a={}){return{id:kt(),type:r,data:a}}function I(r=1,a=null,c=""){return{id:kt(),set:r,reps:a,prescription:c}}function St(r,a){return r==="reps"?{reps:a}:r==="calories"?{calories:a}:r==="meters"?{meters:a}:r==="weight"&&Array.isArray(a)?{setRows:a}:{value:a}}function Ct(r,a){const c=a.measurementType??a.measurement_type??"";return r.map(d=>d&&typeof d=="object"&&"type"in d?{type:d.type??c??"",data:d.data??{}}:d&&typeof d=="object"?{type:c??"",data:d}:{type:c??"",data:St(c??"",d)}).filter(d=>d.type||Object.keys(d.data).length>0)}function Be(r){const a=r.measurements??r.measurement??null;let c=[];const d=r.measurementType??r.measurement_type??"";return Array.isArray(a)?c=Ct(a,r):(d||a)&&(c=[{type:d??"",data:a&&typeof a=="object"?a??{}:St(d??"",a)}]),c}function jt(r){const a=Be(r);return a.length===0?[K()]:a.map(c=>K(c.type,c.data))}function Oe(r){const a=r.measurements;return Array.isArray(a)?Ct(a,r):Be(r)}function _s(r){return r.map(a=>({type:a.type.trim(),data:Rs(a)})).filter(a=>a.type.length>0)}function Rs(r){return r.type==="weight"?{setRows:Et(r.data)}:r.data??{}}function yt(r){const a=Array.isArray(r.reps)?r.reps:[];return a.length?a.map((c,d)=>{const b=typeof(c==null?void 0:c.prescription)=="string"?c.prescription:(c==null?void 0:c.prescription)!=null?String(c.prescription):"";return I((c==null?void 0:c.set)??d+1,(c==null?void 0:c.reps)??null,b)}):[I()]}function $s(r){return r.map((a,c)=>({set:a.set??c+1,reps:a.reps??null,prescription:a.prescription.trim()!==""?a.prescription.trim():null})).filter(a=>a.reps!==null||a.prescription&&a.prescription.length>0)}function Tt(r){if(!r)return"";const a=Ds.find(c=>c.value===r);return(a==null?void 0:a.label)??r}function Ps(r){if(!r)return"";const a=Fe.find(c=>c.value===r);return(a==null?void 0:a.label)??r}function Is(r){switch(r){case"rpe":return"e.g. 8.5 RPE";case"one_rm_percent":return"e.g. 75%";case"rir":return"e.g. 2 reps in reserve";default:return"e.g. 225 lb or 100 kg"}}function Ls(r){return r?r.replace(/<br\s*\/?>/gi,"").replace(/&nbsp;/gi," ").replace(/<[^>]+>/g,"").trim().length===0:!0}function As(r){return r?/<\/?[a-z][\s\S]*>/i.test(r):!1}function zs({value:r,onChange:a,placeholder:c}){const d=u.useRef(null),[b,v]=u.useState(!1);u.useEffect(()=>{if(!d.current)return;const L=d.current.innerHTML;(r??"")!==L&&(d.current.innerHTML=r||"")},[r]);function w(){d.current&&a(d.current.innerHTML)}function y(L){var re;(re=d.current)==null||re.focus(),document.execCommand(L,!1),w()}const M=Ls(r);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm font-medium text-slate-600",children:[t.jsx("button",{type:"button",className:"rounded-xl px-3 py-1 text-xs font-semibold uppercase tracking-wide hover:bg-white",onClick:()=>y("bold"),children:"Bold"}),t.jsx("button",{type:"button",className:"rounded-xl px-3 py-1 text-xs font-semibold uppercase tracking-wide hover:bg-white",onClick:()=>y("italic"),children:"Italic"}),t.jsx("button",{type:"button",className:"rounded-xl px-3 py-1 text-xs font-semibold uppercase tracking-wide hover:bg-white",onClick:()=>y("insertUnorderedList"),children:"Bullets"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{ref:d,className:"min-h-[180px] rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-800 shadow-sm focus-within:border-slate-300 focus-within:ring-2 focus-within:ring-brand-100",contentEditable:!0,onFocus:()=>v(!0),onBlur:()=>{v(!1),w()},onInput:w,suppressContentEditableWarning:!0}),M&&!b&&t.jsx("span",{className:"pointer-events-none absolute left-4 top-3 text-sm text-slate-400",children:c})]})]})}function be(r){const a=Array.isArray(r==null?void 0:r.setRows)?r.setRows:[{set:r==null?void 0:r.set,reps:r==null?void 0:r.reps,load:r==null?void 0:r.load}];return(a.length?a:[{set:1,reps:null,load:""}]).map((d,b)=>({set:Number((d==null?void 0:d.set)??b+1),reps:(d==null?void 0:d.reps)===null||(d==null?void 0:d.reps)===void 0?null:Number(d==null?void 0:d.reps),load:typeof(d==null?void 0:d.load)=="string"?d.load:d!=null&&d.load?String(d.load):""}))}function Et(r){return be(r).map((c,d)=>({set:d+1,reps:typeof c.reps=="number"?c.reps:c.reps??null,load:c.load??""}))}function Os(r){const a=r.type,c=r.data??{};if(a==="weight"){const d=be(c),b=d.slice(0,2).map(v=>`Set ${v.set}: ${v.reps??"—"} reps @ ${v.load&&v.load!==""?v.load:"—"}`);return d.length>2&&b.push(`+${d.length-2} more set${d.length-2===1?"":"s"}`),b}return a==="calories"?[`Calories: ${c.calories??null??"—"}`]:a==="meters"?[`Distance: ${c.meters??null??"—"} m`]:a==="reps"?[`Reps: ${c.reps??null??"—"}`]:a==="weight_load"&&(c!=null&&c.summary)?[String(c.summary)]:Object.keys(c||{}).length?[Object.entries(c).map(([d,b])=>`${d}: ${b}`).join(" · ")]:[]}function Ws(r){const a=Be(r);return a.length?a.flatMap((c,d)=>{const b=Os(c);return a.length>1?[`Phase ${d+1}: ${c.type||"—"}`,...b]:b}):[]}function Fs(r){if(!Array.isArray(r.reps)||r.reps.length===0)return[];const a=Tt(r.metric);return r.reps.map((c,d)=>{const b=c.set??d+1,v=c.reps??"—",w=c.prescription?` @ ${c.prescription}`:"",y=a?` (${a})`:"";return`Set ${b}: ${v} reps${w}${y}`})}function Dt(r){const a=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),d=String(r.getDate()).padStart(2,"0");return`${a}-${c}-${d}`}const J="New Workout";function F(r){const a=r==null?void 0:r.trim();return a?a.toLowerCase()===J.toLowerCase()?J:a:J}function Nt(r){return F(r)===J}const Bs=["Su","Mo","Tu","We","Th","Fr","Sa"];function Us(r){const a=new Date(r.getFullYear(),r.getMonth(),1),c=a.getDay(),d=new Date(a);d.setDate(a.getDate()-c);const b=[];for(let v=0;v<42;v+=1){const w=new Date(d);w.setDate(d.getDate()+v),b.push({date:w,inCurrentMonth:w.getMonth()===r.getMonth()})}return b}function We(r=new Date,a="Mon"){const c=new Date(r),d=c.getDay(),b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].indexOf(a),v=(d-b+7)%7;return c.setDate(c.getDate()-v),c.setHours(0,0,0,0),Dt(c)}function Xs(){var pt,ht,ft,bt;const r=u.useRef(null),a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c={warmup:"linear-gradient(90deg,#fef3c7,#fde68a)",strength:"linear-gradient(90deg,#4b8ff7,#74b2fb)",metcon:"linear-gradient(90deg,#a5f3fc,#67e8f9)",skill:"linear-gradient(90deg,#22c55e,#16a34a)",cooldown:"linear-gradient(90deg,#ede9fe,#ddd6fe)",endurance:"linear-gradient(90deg,#06b6d4,#0ea5e9)",benchmarks:"linear-gradient(90deg,#fb923c,#f97316)",custom:"linear-gradient(90deg,#a855f7,#c084fc)",unscored:"linear-gradient(90deg,#cbd5f5,#94a3b8)",media:"linear-gradient(90deg,#f472b6,#fb7185)",other:"linear-gradient(90deg,#e2e8f0,#f1f5f9)"},d=[{value:"warmup",label:"Warm-up"},{value:"strength",label:"Strength"},{value:"metcon",label:"Metcon"},{value:"skill",label:"Skill Work"},{value:"cooldown",label:"Cool-down"},{value:"endurance",label:"Endurance"},{value:"benchmarks",label:"Benchmarks"},{value:"custom",label:"Custom Workout"},{value:"unscored",label:"Unscored Component"},{value:"media",label:"Media Component"},{value:"other",label:"Other"}],b=[{value:"strength",label:"Strength"},{value:"metcon",label:"Metcon"},{value:"warmup",label:"Warmup"},{value:"cooldown",label:"Cooldown"},{value:"endurance",label:"Endurance"},{value:"benchmarks",label:"Benchmarks"},{value:"custom",label:"Custom Workout"},{value:"skill",label:"Skill"},{value:"unscored",label:"Unscored Component"},{value:"media",label:"Media Component"}],[v,w]=u.useState([]),[y,M]=u.useState(null),[L,re]=u.useState({startOfWeek:"Mon"}),[B,Ue]=u.useState(()=>We(new Date,"Mon")),[_,G]=u.useState([]),[Mt,He]=u.useState(!0),[Ve,T]=u.useState(null),[Y,ge]=u.useState(null),[_t,X]=u.useState(null),[ve,je]=u.useState(null),[A,ye]=u.useState(null),[qe,le]=u.useState(null),[x,f]=u.useState({title:"New Workout",instructions:"",coachNotes:"",athleteNotes:"",exerciseId:"",exerciseType:"strength",measurements:[K()],strengthSets:[I()],metric:"load",visibleTo:"everyone",restSeconds:"",isScored:!1,metconStructure:""}),[k,Q]=u.useState({}),[ae,Ke]=u.useState(!1),[j,U]=u.useState({type:"",date:""}),[ie,oe]=u.useState(!1),[Je,H]=u.useState(!1),[Rt,ce]=u.useState(!1),[Ne,de]=u.useState(""),[ue,Z]=u.useState(!1),[we,ee]=u.useState(!1),[ke,Ge]=u.useState(()=>{const e=new Date;return e.setDate(1),e}),Ye=u.useRef(null),Se=u.useRef(null),Xe=u.useRef(null),Qe=u.useRef(null),Ze=u.useRef(null),et=u.useRef(null),tt=u.useRef(null),[Ce,z]=u.useState(!1),[st,me]=u.useState(!1),[Te,Ee]=u.useState({name:"",description:""}),[$t,Pt]=u.useState(0),[De,xe]=u.useState(!1),[V,It]=u.useState([]),[pe,Lt]=u.useState([]),At=F(x.title),zt=c[j.type||x.exerciseType||"other"]??c.other??"var(--brand-accent)",Ot=((pt=d.find(e=>e.value===(j.type||x.exerciseType)))==null?void 0:pt.label)??"Workout";u.useEffect(()=>{const e=new AbortController;async function s(){try{const n=await $("/workouts/programs",{signal:e.signal});if(e.signal.aborted)return;w(n.data),!y&&n.data.length>0&&M(n.data[0].id)}catch(n){if(Ie(n))return;T(n instanceof Error?n.message:"Failed to load programs")}}return s(),()=>e.abort()},[]),u.useEffect(()=>{const e=new AbortController;async function s(){try{const n=await $("/workouts/exercises",{signal:e.signal});if(e.signal.aborted)return;It(n.data),Lt(n.data)}catch(n){if(Ie(n))return;T(n instanceof Error?n.message:"Failed to load exercises")}}return s(),()=>e.abort()},[]),u.useEffect(()=>{if(!y)return;const e=new AbortController;async function s(){try{He(!0);const n=await $(`/workouts/programs/${y}/calendar?start_date=${B}`,{signal:e.signal});if(e.signal.aborted)return;const o=n.data.days.map(l=>({sessionId:l.session_id??l.sessionId,date:l.date,label:l.label,cards:(l.cards??[]).map(i=>{const h=Oe(i),m=h[0]??null,p=Array.isArray(i.reps)?i.reps:i.reps??null;return{id:i.id,title:i.title,description:i.description??i.instructions??"",instructions:i.instructions??i.description??"",exerciseId:i.exercise_id??i.exerciseId??null,exerciseType:i.exercise_type??i.exerciseType??null,metric:i.metric??i.metric??null,visibleTo:i.visible_to??i.visibleTo??i.visibleTo??null,reps:p,measurementType:i.measurement_type??(m==null?void 0:m.type)??i.measurementType??null,measurement:(m==null?void 0:m.data)??i.measurement??i.measurement??null,measurements:h,restSeconds:i.rest_seconds??i.restSeconds??null,isScored:!!(i.is_scored??i.isScored??!1),coachNotes:i.coach_notes??i.coachNotes??"",athleteNotes:i.athlete_notes??i.athleteNotes??"",color:i.color}})}));G(o),T(null)}catch(n){if(Ie(n)||e.signal.aborted)return;T(n instanceof Error?n.message:"Failed to load workouts")}finally{e.signal.aborted||He(!1)}}return s(),()=>e.abort()},[y,B,$t]);const Wt=u.useMemo(()=>{const e=new Map;return _.forEach((s,n)=>{s.cards.forEach((o,l)=>e.set(o.id,{dayIndex:n,cardIndex:l}))}),e},[_]),Me=u.useMemo(()=>new Set(_.map(e=>e.date)),[_]),te=u.useMemo(()=>_.map(e=>({value:e.date,label:new Date(`${e.date}T00:00:00`).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})})),[_]),Ft=u.useMemo(()=>Us(ke),[ke]),Bt=((ht=te.find(e=>e.value===j.date))==null?void 0:ht.label)??"",Ut=((ft=b.find(e=>e.value===j.type))==null?void 0:ft.label)??"Select type",nt=u.useMemo(()=>{var s;return((s=(V.length?V:pe).find(n=>n.id===x.exerciseId))==null?void 0:s.name)??""},[x.exerciseId,V,pe]),rt=q(j.type||x.exerciseType),_e=rt==="strength",he=rt==="metcon",se=!_e&&!he,Ht=!he,Vt=((bt=W.find(e=>e.value===x.metric))==null?void 0:bt.label)??"Select metric",lt=u.useMemo(()=>{if(!j.type)return[];const e=q(j.type),s=Ne.trim().toLowerCase();return(V.length?V:pe).filter(o=>q(o.type)===e).filter(o=>s?o.name.toLowerCase().includes(s):!0).sort((o,l)=>o.name.localeCompare(l.name))},[j.type,Ne,V,pe]),at=Ht?!!((j.type||x.exerciseType)&&x.exerciseId):!!(j.type||x.exerciseType),qt=Ce?t.jsx("input",{ref:Se,className:"w-full rounded-lg border border-white/60 bg-white/90 px-3 py-1 text-lg font-semibold text-slate-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-100",value:x.title,onChange:e=>Qt(e.target.value),onBlur:ot,onKeyDown:e=>{e.key==="Enter"?(e.preventDefault(),ot()):e.key==="Escape"&&(e.preventDefault(),f(s=>({...s,title:F(s.title)})),z(!1))}}):t.jsx("button",{type:"button",className:"w-full rounded-lg bg-transparent py-1 text-left text-lg font-semibold text-slate-900 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60",onClick:()=>z(!0),children:At});async function Kt(e){e.preventDefault();try{const s=await $("/workouts/programs",{method:"POST",body:JSON.stringify(Te)});w(n=>[...n,s.data]),M(s.data.id),me(!1),Ee({name:"",description:""})}catch(s){T(s instanceof Error?s.message:"Unable to create program")}}async function Jt(e){var n;const s=e.sessionId;try{const l=(await $(`/workouts/${s}/items`,{method:"POST",body:JSON.stringify({title:J,exercise_type:"strength",instructions:"Describe goals, load, and cues.",metric:"load",visible_to:"everyone",reps:[]})})).data,i=Oe(l),h=i[0]??null,m=F(l.title),p={id:l.id,title:m,description:l.instructions??l.description??"",instructions:l.instructions??l.description??"",exerciseId:l.exercise_id??null,exerciseType:l.exercise_type??"strength",metric:l.metric??null,visibleTo:l.visible_to??null,reps:Array.isArray(l.reps)?l.reps:null,measurementType:l.measurement_type??(h==null?void 0:h.type)??"",measurement:(h==null?void 0:h.data)??l.measurement??{},measurements:i,restSeconds:l.rest_seconds??null,isScored:!!(l.is_scored??!1),coachNotes:l.coach_notes??"",athleteNotes:l.athlete_notes??"",color:l.color??null,metconStructure:l.metcon_structure??null};G(S=>S.map(g=>g.sessionId===s?{...g,cards:[...g.cards,p]}:g)),ye(p),le(s),f({title:F(p.title),instructions:p.instructions??"",coachNotes:p.coachNotes??"",athleteNotes:p.athleteNotes??"",exerciseId:p.exerciseId??"",exerciseType:p.exerciseType??"strength",strengthSets:yt(p),metric:p.metric??"load",visibleTo:p.visibleTo??"everyone",measurements:jt(p),restSeconds:((n=p.restSeconds)==null?void 0:n.toString())??"",isScored:p.isScored??!1,metconStructure:p.metcon_structure??p.metconStructure??""}),Q({}),U({type:"",date:""}),z(!1)}catch(o){T(o instanceof Error?o.message:"Failed to create workout")}}function Gt(e){U(s=>({...s,type:e})),f(s=>{const n=e==="strength"?"load":e==="metcon"?W.some(o=>o.value===s.metric)?s.metric:W[0].value:s.metric;return{...s,exerciseType:e,exerciseId:"",strengthSets:e==="strength"?[I()]:s.strengthSets,metric:n,visibleTo:e==="strength"?"everyone":s.visibleTo,metconStructure:e==="metcon"?"":s.metconStructure,title:Nt(s.title)?J:s.title}}),R("exercise_type"),oe(!1),H(!1),ce(e!=="metcon"),de(""),e==="metcon"&&H(!1),Z(!1)}function Yt(e){if(U(n=>({...n,date:e})),!e||!A||!qe)return;const s=_.find(n=>n.date===e);s&&s.sessionId!==qe&&(ct(A.id,s.sessionId),le(s.sessionId)),ee(!1)}function Xt(e){const s=xs(e);f(n=>{const o=n.measurements.length?[...n.measurements]:[K()];o[0]={...o[0],type:s.type,data:s.data};const l=q(e.type??n.exerciseType),i=s.data,h=typeof(i==null?void 0:i.reps)=="number"?Number(i.reps):8,m=l==="strength"?[I(1,h,"")]:n.strengthSets;return{...n,exerciseId:e.id,exerciseType:e.type??n.exerciseType,strengthSets:m,metric:l==="strength"?"load":l==="metcon"?W.some(p=>p.value===n.metric)?n.metric:W[0].value:n.metric,visibleTo:l==="strength"?"everyone":n.visibleTo,title:Nt(n.title)?e.name:n.title,measurements:o}}),R("exercise_id"),de(""),H(!1),ce(!1)}function it(e){Ge(s=>{const n=new Date(s);return n.setMonth(s.getMonth()+e,1),n})}function Qt(e){f(s=>({...s,title:e})),R("title")}function ot(){f(e=>({...e,title:F(e.title)})),z(!1)}function Re(){ye(null),Q({}),U({type:"",date:""}),le(null),oe(!1),H(!1),de(""),ee(!1),z(!1),Z(!1)}function fe(){Pt(e=>e+1)}async function Zt(e){G(s=>s.map(n=>({...n,cards:n.cards.filter(o=>o.id!==e)})));try{await $(`/workouts/items/${e}`,{method:"DELETE"})}catch(s){T(s instanceof Error?s.message:"Unable to delete card"),fe()}}async function es(e){try{await $(`/workouts/items/${e}/duplicate`,{method:"POST"}),fe()}catch(s){T(s instanceof Error?s.message:"Unable to duplicate")}}async function ct(e,s,n){const o=Wt.get(e);if(o){G(l=>{const i=l.map(C=>({...C,cards:[...C.cards]})),{dayIndex:h,cardIndex:m}=o,[p]=i[h].cards.splice(m,1),S=i.find(C=>C.sessionId===s);if(!S)return l;const g=n??S.cards.length;return S.cards.splice(g,0,p),i});try{await $(`/workouts/items/${e}/move`,{method:"POST",body:JSON.stringify({workout_id:s,position:n??null})})}catch(l){T(l instanceof Error?l.message:"Unable to move card"),fe()}}}function dt(e,s){if(!Y)return;const n=_.find(l=>l.sessionId===e);if(!n)return;const o=s?n.cards.findIndex(l=>l.id===s):n.cards.length;ct(Y,e,o<0?void 0:o),ge(null)}async function ts(e){var s,n;if(e.preventDefault(),!!A)try{Ke(!0);const o=_s(x.measurements),l=o[0]??null,i=$s(x.strengthSets),m=(await $(`/workouts/items/${A.id}`,{method:"PUT",body:JSON.stringify({title:x.title,instructions:x.instructions,coach_notes:x.coachNotes,athlete_notes:x.athleteNotes,exercise_id:x.exerciseId||null,exercise_type:x.exerciseType,metric:x.metric||null,visible_to:x.visibleTo||null,reps:i,measurement_type:(l==null?void 0:l.type)??null,measurement:(l==null?void 0:l.data)??null,measurements:o,rest_seconds:x.restSeconds?Number(x.restSeconds):null,is_scored:x.isScored,metcon_structure:x.metconStructure||null})})).data,p=Oe(m),S=m.measurement_type??((s=p==null?void 0:p[0])==null?void 0:s.type)??null,g=m.measurement??((n=p==null?void 0:p[0])==null?void 0:n.data)??null;G(C=>C.map(gt=>({...gt,cards:gt.cards.map(N=>N.id===A.id?{...N,title:m.title,description:m.instructions??m.description??"",instructions:m.instructions??m.description??"",exerciseId:m.exercise_id??N.exerciseId??null,exerciseType:m.exercise_type??N.exerciseType??null,metric:m.metric??N.metric??null,visibleTo:m.visible_to??m.visibleTo??N.visibleTo??null,reps:Array.isArray(m.reps)?m.reps:N.reps??null,measurementType:S??N.measurementType??null,measurement:g??N.measurement??null,measurements:p,restSeconds:m.rest_seconds??N.restSeconds??null,isScored:!!(m.is_scored??N.isScored??!1),coachNotes:m.coach_notes??N.coachNotes??"",athleteNotes:m.athlete_notes??N.athleteNotes??"",metconStructure:m.metcon_structure??N.metconStructure??null}:N)}))),fe(),Re()}catch(o){if(o instanceof Error){try{const l=JSON.parse(o.message);if(l!=null&&l.errors){Q(l.errors);return}}catch{}T(o.message||"Unable to save workout")}else T("Unable to save workout")}finally{Ke(!1)}}function ss(){const e=new Date(`${B}T00:00:00`),s=new Date(e);return s.setDate(e.getDate()+6),`${e.toLocaleDateString(void 0,{month:"short",day:"numeric"})} – ${s.toLocaleDateString(void 0,{month:"short",day:"numeric"})}`}u.useEffect(()=>{if(!De)return;function e(s){r.current&&(r.current.contains(s.target)||xe(!1))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[De]),u.useEffect(()=>{Ue(e=>We(new Date(`${e}T00:00:00`),L.startOfWeek))},[L.startOfWeek]),u.useEffect(()=>{if(!j.date)return;const e=new Date(`${j.date}T00:00:00`);e.setDate(1),Ge(e)},[j.date]),u.useEffect(()=>{if(!we)return;function e(s){var n,o;(n=Ze.current)!=null&&n.contains(s.target)||(o=Qe.current)!=null&&o.contains(s.target)||ee(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[we]),u.useEffect(()=>{if(!ie)return;function e(s){var n,o;(n=Xe.current)!=null&&n.contains(s.target)||(o=Ye.current)!=null&&o.contains(s.target)||oe(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ie]),u.useEffect(()=>{if(!ue)return;function e(s){var n,o;(n=tt.current)!=null&&n.contains(s.target)||(o=et.current)!=null&&o.contains(s.target)||Z(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ue]),u.useEffect(()=>{if(!Ce)return;const e=window.requestAnimationFrame(()=>{var s,n;(s=Se.current)==null||s.focus(),(n=Se.current)==null||n.select()});return()=>window.cancelAnimationFrame(e)},[Ce]),u.useEffect(()=>{j.date&&(Me.has(j.date)||U(e=>({...e,date:""})))},[Me,j.date]),u.useEffect(()=>{te.length===0&&ee(!1)},[te.length]),u.useEffect(()=>{z(!1)},[A]),u.useEffect(()=>{x.exerciseId||ce(!0)},[x.exerciseId]);function ut(e){const s=new Date(`${B}T00:00:00`);s.setDate(s.getDate()+e*7),Ue(We(s,L.startOfWeek))}function ns(){console.info("Clone week triggered for",B)}function rs(){console.info("Delete week triggered for",B)}function R(e){Q(s=>{if(!s[e])return s;const{[e]:n,...o}=s;return o})}function ls(e){f(s=>{const n=[...s.measurements],o=K();return typeof e=="number"?n.splice(e,0,o):n.push(o),{...s,measurements:n}})}function as(e){f(s=>{if(s.measurements.length<=1)return s;const n=s.measurements.filter((o,l)=>l!==e);return{...s,measurements:n}})}function is(e,s){f(n=>{const o=n.measurements.map((l,i)=>i===e?{...l,type:s,data:s==="weight"?{setRows:Et({})}:{}}:l);return{...n,measurements:o}}),R(`measurements.${e}.type`)}function $e(e,s,n){f(o=>{const l=o.measurements.map((i,h)=>{if(h!==e)return i;const m={...i.data};return cs(m,s,n),{...i,data:m}});return{...o,measurements:l}}),R(`measurements.${e}.${s}`)}function Pe(e,s){f(n=>{const o=n.measurements.map((l,i)=>{if(i!==e)return l;const h=s(be(l.data));return{...l,data:{...l.data,setRows:h}}});return{...n,measurements:o}})}function os(e,s){Pe(e,n=>{const o=[...n],l=typeof s=="number"?s:n.length;return o.splice(l,0,{set:l+1,reps:null,load:""}),o.map((i,h)=>({...i,set:h+1}))})}function cs(e,s,n){const o=s.split("."),l=o.pop();let i=e;for(const m of o)if(/^\d+$/.test(m)){const S=Number(m);if(!Array.isArray(i))return;i[S]||(i[S]={}),i=i[S]}else(!(m in i)||i[m]===null)&&(i[m]={}),i=i[m];if(l===void 0)return;if(/^\d+$/.test(l)){const m=Number(l);if(!Array.isArray(i))return;i[m]=n}else i[l]=n}function ds(e,s){Pe(e,n=>n.length<=1?n:n.filter((l,i)=>i!==s).map((l,i)=>({...l,set:i+1})))}function mt(e,s,n,o){Pe(e,l=>l.map((i,h)=>h===s?{...i,[n]:n==="load"?String(o??""):n==="reps"?o===null||o===""?null:Number(o):Number(o??i.set)}:i)),R(`measurements.${e}.setRows.${s}.${n}`)}function us(e){f(s=>{const n=s.strengthSets&&s.strengthSets.length>0?[...s.strengthSets]:[I()],o=typeof e=="number"?e:n.length;n.splice(o,0,I(o+1));const l=n.map((i,h)=>({...i,set:h+1}));return{...s,strengthSets:l}})}function ms(e){f(s=>{const n=s.strengthSets&&s.strengthSets.length>1?s.strengthSets:[I()];if(n.length<=1)return s;const o=n.filter((l,i)=>i!==e).map((l,i)=>({...l,set:i+1}));return{...s,strengthSets:o}})}function xt(e,s,n){f(o=>{const i=(o.strengthSets&&o.strengthSets.length>0?[...o.strengthSets]:[I()]).map((h,m)=>{if(m!==e)return h;if(s==="reps"){if(n==="")return{...h,reps:null};const p=Number(n);return{...h,reps:Number.isNaN(p)?null:p}}return{...h,prescription:n}});return{...o,strengthSets:i}})}function q(e){const s=(e??"").normalize("NFKC").replace(/\s+/g," ").trim().toLowerCase();return s===""||s==="n/a"?"other":["warmup","warm-up","warm up"].includes(s)?"warmup":["cooldown","cool-down","cool down"].includes(s)?"cooldown":["metcon","met-con","conditioning"].includes(s)?"metcon":["skill","skill work","skills"].includes(s)?"skill":["strength","lift"].includes(s)?"strength":["endurance"].includes(s)?"endurance":["benchmark","benchmarks"].includes(s)?"benchmarks":["custom workout","custom"].includes(s)?"custom":s.includes("unscored")?"unscored":s.includes("media")?"media":s}function xs(e){const s=q(e.type),n=(e.modality??"").toLowerCase(),o=e.name.toLowerCase();return s==="cooldown"||s==="warmup"?{type:"meters",data:{meters:100}}:s==="metcon"?n.includes("erg")||n.includes("bike")||n.includes("run")||o.includes("row")?{type:"meters",data:{meters:400}}:o.includes("calorie")||n.includes("bike")?{type:"calories",data:{calories:20}}:{type:"reps",data:{reps:15}}:s==="skill"?{type:"reps",data:{reps:5}}:n.includes("barbell")||n.includes("dumbbell")||n.includes("kettlebell")?{type:"weight",data:{weight:95,unit:"lb"}}:{type:"reps",data:{reps:8}}}const ps=t.jsxs("div",{className:"flex items-center gap-3",ref:r,children:[Ve&&t.jsx("p",{className:"text-sm text-rose-600",children:Ve}),t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 text-slate-600 hover:bg-slate-50",title:"Preferences",onClick:()=>xe(e=>!e),children:t.jsx(fs,{size:18})}),De&&t.jsxs("div",{className:"absolute right-0 mt-2 w-64 rounded-2xl border border-slate-100 bg-white p-4 text-sm shadow-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Start week on"}),t.jsx(P,{className:"mt-1",value:L.startOfWeek,onChange:e=>re(s=>({...s,startOfWeek:e.target.value})),children:a.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsx("div",{className:"my-3 border-t border-slate-100"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("button",{type:"button",className:"rounded-xl border border-slate-200 px-3 py-2 text-left font-semibold text-slate-700 hover:bg-slate-50",onClick:()=>{xe(!1),ns()},children:"Clone this week"}),t.jsx("button",{type:"button",className:"rounded-xl border border-rose-200 px-3 py-2 text-left font-semibold text-rose-600 hover:bg-rose-50",onClick:()=>{xe(!1),rs()},children:"Delete this week"})]})]})]})]});return t.jsxs("div",{className:"space-y-6",children:[t.jsx(vt,{title:"Workout builder",subtitle:"Drag workouts between days and manage programs",right:ps,children:t.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 text-sm",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Program"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(P,{value:y??"",onChange:e=>M(e.target.value),className:"w-auto rounded-lg",children:v.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),t.jsx("button",{type:"button",onClick:()=>me(!0),className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 text-slate-600",title:"Create program",children:t.jsx(ne,{size:16})})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Week"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{type:"button",onClick:()=>ut(-1),children:"Prev"}),t.jsx("span",{className:"font-semibold text-slate-700",children:ss()}),t.jsx(O,{type:"button",onClick:()=>ut(1),children:"Next"})]})]})]})}),Mt?t.jsx(vt,{title:"Loading week",children:t.jsx("p",{className:"text-sm text-slate-500",children:"Fetching workouts…"})}):t.jsx("div",{className:"grid gap-4 lg:grid-cols-7",children:_.map(e=>t.jsxs("div",{className:"rounded-3xl border border-slate-100 bg-slate-50 shadow-inner",children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-white/70 bg-white/60 px-4 py-3",children:[t.jsxs("div",{children:[(()=>{const s=new Date(`${e.date}T00:00:00`);return t.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})})})(),t.jsx("p",{className:"text-xs text-slate-500",children:e.label||"—"})]}),t.jsx("button",{type:"button",className:"rounded-full border border-slate-200 p-2 text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-brand-200 hover:-translate-y-0.5",style:{backgroundImage:"linear-gradient(90deg, var(--brand-primary), var(--brand-accent))"},onClick:()=>Jt(e),children:t.jsx(ne,{size:16})})]}),t.jsx("div",{className:"flex min-h-[420px] flex-col gap-3 overflow-y-auto px-3 py-4",onDragOver:s=>s.preventDefault(),onDrop:s=>{s.preventDefault(),dt(e.sessionId)},children:e.cards.map(s=>{const n=q(s.exerciseType),o=c[n]??c.other,l=Ws(s),h=[...Fs(s),...l],m=[];s.isScored&&m.push({label:"Scored",tone:"primary"}),s.restSeconds&&m.push({label:`Rest ${s.restSeconds}s`,tone:"neutral"}),s.metric&&m.push({label:`Metric · ${Tt(s.metric)}`,tone:"neutral"}),s.visibleTo&&m.push({label:`Visible · ${Ps(s.visibleTo)}`,tone:"note"}),s.athleteNotes&&m.push({label:"Athlete note",tone:"note",note:s.athleteNotes}),s.coachNotes&&m.push({label:"Coach note",tone:"warn",note:s.coachNotes});const p=s.instructions??s.description??"",S=As(p);return t.jsxs("article",{draggable:!0,onDragStart:g=>{if(_t!==s.id){g.preventDefault();return}ge(s.id)},onDragEnd:()=>{ge(null),X(null)},onDragOver:g=>g.preventDefault(),onDrop:g=>{g.preventDefault(),dt(e.sessionId,s.id)},className:`rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden ${Y===s.id?"opacity-50":""}`,children:[t.jsxs("div",{className:"flex items-center gap-2 pl-2 pr-4 py-1.5 text-white cursor-grab active:cursor-grabbing select-none",style:{background:o},role:"button",tabIndex:0,onMouseDown:()=>X(s.id),onMouseUp:()=>{Y||X(null)},onMouseLeave:()=>{Y||X(null)},onTouchStart:()=>X(s.id),children:[t.jsx(ws,{className:"h-4 w-4 -ml-1 text-white/80"}),t.jsx("p",{className:"text-base font-semibold leading-tight",children:s.title})]}),t.jsxs("div",{className:"p-3 space-y-2",children:[p&&(S?t.jsx("div",{className:"text-sm text-slate-600 [&>*]:mb-1 [&>*:last-child]:mb-0",dangerouslySetInnerHTML:{__html:p}}):t.jsx("p",{className:"text-sm text-slate-600",children:p})),h.length>0&&t.jsx("ul",{className:"space-y-1 text-xs text-slate-500",children:h.map((g,C)=>t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-slate-300"}),t.jsx("span",{children:g})]},`${s.id}-summary-${C}`))}),m.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:m.map((g,C)=>t.jsx(Cs,{content:g.note,children:t.jsx("span",{className:`rounded-full px-2 py-1 text-[10px] font-semibold ${g.tone==="primary"?"bg-emerald-50 text-emerald-700":g.tone==="note"?"bg-sky-50 text-sky-700":g.tone==="warn"?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-600"}`,children:g.label})},`${s.id}-chip-${C}`))}),t.jsxs("div",{className:"flex items-center gap-2 text-slate-400 pt-1",children:[t.jsx("button",{type:"button",onClick:()=>Zt(s.id),title:"Delete",className:"hover:text-rose-500",children:t.jsx(ze,{size:16})}),t.jsx("button",{type:"button",onClick:()=>es(s.id),title:"Duplicate",className:"hover:text-slate-700",children:t.jsx(ys,{size:16})}),t.jsx("button",{type:"button",onClick:()=>je(s),title:"Preview",className:"hover:text-slate-700",children:t.jsx(Ns,{size:16})}),t.jsx("button",{type:"button",onClick:()=>{var g;ye(s),le(e.sessionId),f({title:F(s.title),instructions:s.instructions??s.description??"",coachNotes:s.coachNotes??"",athleteNotes:s.athleteNotes??"",exerciseId:s.exerciseId??"",exerciseType:s.exerciseType??"strength",strengthSets:yt(s),metric:s.metric??"load",visibleTo:s.visibleTo??"everyone",measurements:s.measurements&&s.measurements.length?s.measurements.map(C=>K(C.type??"",C.data??{})):jt(s),restSeconds:((g=s.restSeconds)==null?void 0:g.toString())??"",isScored:s.isScored??!1,metconStructure:s.metcon_structure??s.metconStructure??""}),Q({}),U({type:s.exerciseType??"strength",date:e.date}),z(!1)},title:"Edit",className:"hover:text-slate-700",children:t.jsx(Ss,{size:16})})]})]})]},s.id)})})]},e.sessionId))}),ve&&t.jsx(Le,{open:!0,onClose:()=>je(null),title:ve.title,children:t.jsxs("div",{className:"space-y-4 text-sm text-slate-700",children:[t.jsxs("section",{children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-amber-600",children:"Workout Definition"}),t.jsx("p",{className:"mt-1 text-slate-800",children:ve.description})]}),t.jsxs("section",{children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-sky-600",children:"Athlete Notes"}),t.jsx("p",{className:"mt-1 text-slate-800",children:"Focus on tempo and bracing. Keep ribs stacked and drive vertically."})]}),t.jsxs("section",{children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Coach Notes"}),t.jsx("p",{className:"mt-1 text-slate-500",children:"Use RPE 8.5 cap; scale to DB presses if shoulder issues appear."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(O,{type:"button",onClick:()=>je(null),children:"Close"})})]})}),A&&t.jsx(Le,{open:!0,onClose:()=>{ae||Re()},title:qt,subtitle:Ot,headerStyle:{background:zt},headerClassName:"border-transparent",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"block text-sm font-semibold text-slate-700",children:["Workout Type",t.jsxs("div",{className:"relative mt-2",children:[t.jsxs("button",{ref:Ye,type:"button",onClick:()=>oe(e=>!e),className:"flex w-full items-center justify-between rounded-2xl border-2 border-slate-200 bg-white px-4 py-3 text-left text-base font-semibold text-slate-800",children:[t.jsx("span",{children:Ut}),t.jsx(Ae,{size:18,className:`text-slate-500 transition ${ie?"rotate-180":""}`})]}),ie&&t.jsx("div",{ref:Xe,className:"absolute z-20 mt-2 w-full rounded-2xl border border-slate-200 bg-white shadow-2xl",children:t.jsx("div",{className:"max-h-64 overflow-y-auto py-2",children:b.map(e=>{const s=j.type===e.value;return t.jsxs("button",{type:"button",onClick:()=>Gt(e.value),className:`flex w-full items-center justify-between px-4 py-2 text-sm font-semibold ${s?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-50"}`,children:[t.jsx("span",{children:e.label}),s&&t.jsx("span",{className:"text-xs uppercase tracking-wide",children:"Selected"})]},e.value)})})})]})]}),t.jsxs("div",{className:"block text-sm font-semibold text-slate-700",children:["Workout Date",t.jsxs("div",{className:"relative mt-2",children:[t.jsxs("button",{ref:Qe,type:"button",disabled:te.length===0,onClick:()=>{te.length!==0&&ee(e=>!e)},className:"flex w-full items-center justify-between rounded-2xl border-2 border-slate-200 bg-white px-4 py-3 text-left text-base font-semibold text-slate-800 disabled:cursor-not-allowed disabled:opacity-50",children:[t.jsx("span",{children:Bt||"Select date"}),t.jsx(gs,{size:18,className:"text-slate-500"})]}),we&&t.jsxs("div",{ref:Ze,className:"absolute z-20 mt-2 w-full rounded-2xl border border-slate-200 bg-white p-4 shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-700",children:[t.jsx("button",{type:"button",className:"rounded-full border border-slate-200 p-1 text-slate-500 hover:bg-slate-50",onClick:()=>it(-1),children:t.jsx(vs,{size:16})}),t.jsx("span",{children:ke.toLocaleDateString(void 0,{month:"long",year:"numeric"})}),t.jsx("button",{type:"button",className:"rounded-full border border-slate-200 p-1 text-slate-500 hover:bg-slate-50",onClick:()=>it(1),children:t.jsx(js,{size:16})})]}),t.jsx("div",{className:"mt-3 grid grid-cols-7 text-center text-xs font-semibold uppercase tracking-wide text-slate-400",children:Bs.map(e=>t.jsx("span",{children:e},e))}),t.jsx("div",{className:"mt-2 grid grid-cols-7 gap-1",children:Ft.map(e=>{const s=Dt(e.date),n=Me.has(s),l=["h-10 rounded-xl text-sm font-semibold transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-200",j.date===s?"bg-slate-900 text-white":"text-slate-700",e.inCurrentMonth?"":"opacity-50",n?"hover:bg-slate-100":"cursor-not-allowed opacity-25"].filter(Boolean).join(" ");return t.jsx("button",{type:"button",disabled:!n,onClick:()=>Yt(s),className:l,children:e.date.getDate()},`${s}-${e.date.getDate()}`)})}),t.jsx("p",{className:"mt-3 text-xs text-slate-500",children:"Pick a date inside the currently visible week."})]})]})]})]}),j.type&&!he&&t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[Rt?[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("span",{children:"Exercise"}),t.jsxs("div",{className:"relative mt-2",children:[t.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-2xl border-2 border-slate-200 bg-white px-4 py-3 text-left text-base font-semibold text-slate-800 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>H(e=>!e),disabled:!j.type,children:[t.jsx("span",{children:nt||"Exercise"}),t.jsx(Ae,{size:18,className:`text-slate-500 transition ${Je?"rotate-180":""}`})]}),Je&&t.jsxs("div",{className:"mt-3 rounded-3xl border border-slate-200 bg-white p-4 shadow-inner",children:[t.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500",children:[t.jsx(bs,{size:16}),t.jsx("input",{type:"text",className:"w-full bg-transparent text-sm font-medium text-slate-700 outline-none",placeholder:"Search exercises...",value:Ne,onChange:e=>de(e.target.value)})]}),t.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto rounded-2xl border border-slate-100",children:lt.length===0?t.jsx("p",{className:"px-4 py-6 text-center text-sm text-slate-500",children:"No exercises match this search."}):t.jsx("div",{className:"flex flex-col",children:lt.map(e=>t.jsxs("button",{type:"button",className:`flex w-full items-center justify-between px-4 py-2 text-left text-sm font-semibold ${x.exerciseId===e.id?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>Xt(e),children:[t.jsx("span",{children:e.name}),t.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:e.modality||(e.is_public?"Std":"Custom")})]},e.id))})})]})]})]},"exercise-picker"),t.jsx("div",{},"right-empty")]:[t.jsx("div",{className:"cursor-pointer select-none text-base font-semibold text-slate-900",onDoubleClick:()=>{ce(!0),H(!0)},title:"Double-click to change exercise",children:nt||x.title},"exercise-title"),_e?t.jsxs("div",{className:"flex flex-wrap items-end justify-between",children:[t.jsxs("label",{className:"block text-left text-xs font-semibold uppercase tracking-wide text-slate-600",children:[t.jsx("span",{className:"block text-[11px] text-slate-500",children:"Visible to"}),t.jsx(P,{className:"mt-1 min-w-[150px]",value:x.visibleTo,onChange:e=>f(s=>({...s,visibleTo:e.target.value})),children:Fe.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsx("button",{type:"button",className:`rounded-full px-4 py-2 text-sm font-semibold ${x.isScored?"bg-emerald-600 text-white":"bg-slate-100 text-slate-600"}`,onClick:()=>f(e=>({...e,isScored:!e.isScored})),children:x.isScored?"Scored":"Unscored"})]}):t.jsx("div",{},"strength-placeholder")],k.exercise_id&&t.jsx("p",{className:"mt-2 text-xs text-rose-600 md:col-span-2",children:k.exercise_id[0]})]}),!at&&t.jsx("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-4 py-6 text-center text-sm text-slate-500",children:"Select a workout type and exercise to begin configuring the workout details."}),at&&t.jsxs("form",{className:"space-y-6",onSubmit:ts,children:[se&&t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:t.jsxs("div",{className:"md:col-span-2 flex flex-wrap items-end justify-between gap-4",children:[t.jsxs("label",{className:"flex-1 min-w-[220px] block text-sm font-medium text-slate-700",children:["Title",t.jsx(D,{className:"mt-1",value:x.title,onChange:e=>{f(s=>({...s,title:e.target.value})),R("title")},required:!0}),k.title&&t.jsx("p",{className:"mt-1 text-xs text-rose-600",children:k.title[0]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[t.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Scoring"}),t.jsx("button",{type:"button",className:`rounded-full px-4 py-2 text-sm font-semibold ${x.isScored?"bg-emerald-600 text-white":"bg-slate-100 text-slate-600"}`,onClick:()=>f(e=>({...e,isScored:!e.isScored})),children:x.isScored?"Scored":"Unscored"}),t.jsx("span",{className:"text-[11px] text-slate-500",children:"Scored workouts surface on leaderboards."})]})]})}),se&&t.jsx("div",{children:t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Exercise type",t.jsx(P,{className:"mt-1",value:x.exerciseType,onChange:e=>{f(s=>({...s,exerciseType:e.target.value})),R("exercise_type")},children:d.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),k.exercise_type&&t.jsx("p",{className:"mt-1 text-xs text-rose-600",children:k.exercise_type[0]})]})}),he&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("label",{className:"block text-left text-xs font-semibold uppercase tracking-wide text-slate-600",children:[t.jsx("span",{className:"block text-[11px] text-slate-500",children:"Name"}),t.jsx(D,{className:"mt-1",value:x.title,onChange:e=>{f(s=>({...s,title:e.target.value})),R("title")},required:!0}),k.title&&t.jsx("p",{className:"mt-1 text-xs text-rose-600",children:k.title[0]})]}),t.jsx("div",{className:"flex flex-col",children:t.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[t.jsxs("label",{className:"block text-left text-xs font-semibold uppercase tracking-wide text-slate-600",children:[t.jsx("span",{className:"block text-[11px] text-slate-500",children:"Visible to"}),t.jsx(P,{className:"mt-1 min-w-[150px]",value:x.visibleTo,onChange:e=>f(s=>({...s,visibleTo:e.target.value})),children:Fe.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsx("button",{type:"button",className:`rounded-full px-4 py-2 text-sm font-semibold ${x.isScored?"bg-emerald-600 text-white":"bg-slate-100 text-slate-600"}`,onClick:()=>f(e=>({...e,isScored:!e.isScored})),children:x.isScored?"Scored":"Unscored"})]})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Metcon overview"}),t.jsx("div",{className:"mt-2",children:t.jsx(zs,{value:x.instructions,onChange:e=>f(s=>({...s,instructions:e})),placeholder:"Describe pacing, loading, and coaching cues"})})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Format",t.jsx(P,{className:"mt-1",value:x.metconStructure,onChange:e=>f(s=>({...s,metconStructure:e.target.value})),children:Es.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value||"metcon-format-placeholder"))})]}),t.jsxs("div",{className:"block text-sm font-medium text-slate-700",children:["Metric",t.jsxs("div",{className:"relative mt-2",children:[t.jsxs("button",{ref:et,type:"button",className:"flex w-full items-center justify-between rounded-2xl border-2 border-slate-200 bg-white px-4 py-3 text-left text-base font-semibold text-slate-800",onClick:()=>Z(e=>!e),children:[t.jsx("span",{children:Vt}),t.jsx(Ae,{size:18,className:`text-slate-500 transition ${ue?"rotate-180":""}`})]}),ue&&t.jsx("div",{ref:tt,className:"absolute right-0 z-20 mt-2 w-full rounded-2xl border border-slate-200 bg-white shadow-2xl",children:t.jsx("div",{className:"max-h-64 overflow-y-auto py-2",children:W.map(e=>{const s=x.metric===e.value;return t.jsxs("button",{type:"button",className:`flex w-full items-center justify-between px-4 py-2 text-sm font-semibold ${s?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-50"}`,onClick:()=>{f(n=>({...n,metric:e.value})),Z(!1)},children:[t.jsx("span",{children:e.label}),s&&t.jsx("span",{className:"text-xs uppercase tracking-wide text-white/80",children:"Selected"})]},e.value)})})})]})]})]})]}),se&&t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Workout instructions",t.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",rows:3,placeholder:"Describe goals, pacing, and coaching cues",value:x.instructions,onChange:e=>f(s=>({...s,instructions:e.target.value}))})]}),se&&t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Rest between sets (seconds)",t.jsx(D,{type:"number",min:0,className:"mt-1",value:x.restSeconds,onChange:e=>f(s=>({...s,restSeconds:e.target.value})),placeholder:"e.g. 60"})]}),t.jsx("div",{className:"text-xs text-slate-500 self-end",children:"Leave blank if the workout block doesn’t have prescribed rest."})]}),_e?t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-[50px_100px_minmax(0,1fr)_140px_80px]",children:[t.jsxs("div",{className:"contents",children:[t.jsx("div",{}),t.jsx("div",{}),t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Metric",t.jsx(P,{className:"mt-1",value:x.metric,onChange:e=>f(s=>({...s,metric:e.target.value})),children:wt.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsx("div",{}),t.jsx("div",{})]}),x.strengthSets.map((e,s)=>t.jsxs("div",{className:"contents",children:[t.jsxs("div",{className:"flex items-center text-sm font-semibold text-slate-700",children:["Set ",s+1]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Reps"}),t.jsxs(P,{className:"mt-1",value:e.reps??"",onChange:n=>xt(s,"reps",n.target.value),children:[t.jsx("option",{value:"",children:"Select"}),Ms.map(n=>t.jsx("option",{value:n,children:n},`strength-reps-${n}`))]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Metric value"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx(D,{className:"flex-1",value:e.prescription,placeholder:Is(x.metric),onChange:n=>xt(s,"prescription",n.target.value)}),x.metric==="one_rm_percent"&&t.jsx("span",{className:"text-sm font-semibold text-slate-500",children:"%"})]})]}),t.jsx("div",{}),t.jsxs("div",{className:"flex items-center justify-end gap-1 pb-1",children:[x.strengthSets.length>1&&t.jsx("button",{type:"button",onClick:()=>ms(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-rose-50",title:"Remove set",children:t.jsx(ks,{size:14})}),s===x.strengthSets.length-1&&t.jsx("button",{type:"button",onClick:()=>us(s+1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-100",title:"Add set",children:t.jsx(ne,{size:14})})]})]}))]})}):se?t.jsxs("div",{className:"space-y-4",children:[x.measurements.map((e,s)=>t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/60 p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsxs("label",{className:"flex-1 text-sm font-medium text-slate-700",children:["Measurement type",t.jsxs(P,{className:"mt-1",value:e.type,onChange:n=>is(s,n.target.value),children:[t.jsx("option",{value:"",children:"Select"}),Ts.map(n=>t.jsx("option",{value:n.value,children:n.label},n.value))]}),k[`measurements.${s}.type`]&&t.jsx("p",{className:"mt-1 text-xs text-rose-600",children:k[`measurements.${s}.type`][0]})]}),t.jsxs("div",{className:"flex gap-1 pb-1",children:[t.jsx("button",{type:"button",onClick:()=>ls(s+1),className:"rounded-full border border-slate-200 p-2 text-slate-500 hover:bg-slate-100",title:"Add measurement",children:t.jsx(ne,{size:14})}),x.measurements.length>1&&t.jsx("button",{type:"button",onClick:()=>as(s),className:"rounded-full border border-slate-200 p-2 text-slate-500 hover:bg-rose-50",title:"Remove measurement",children:t.jsx(ze,{size:14})})]})]}),e.type==="calories"&&t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Calories",t.jsx(D,{type:"number",min:0,className:"mt-1",value:e.data.calories??"",onChange:n=>$e(s,"calories",Number(n.target.value))})]}),e.type==="meters"&&t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Distance (meters)",t.jsx(D,{type:"number",min:0,className:"mt-1",value:e.data.meters??"",onChange:n=>$e(s,"meters",Number(n.target.value))})]}),e.type==="reps"&&t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Reps",t.jsx(D,{type:"number",min:0,className:"mt-1",value:e.data.reps??"",onChange:n=>$e(s,"reps",Number(n.target.value))})]}),e.type==="weight"&&(()=>{const n=be(e.data);return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-[60px_110px_minmax(0,_1fr)_70px] gap-3 text-xs font-semibold uppercase tracking-wide text-slate-500",children:[t.jsx("span",{children:"Set #"}),t.jsx("span",{children:"Reps"}),t.jsx("span",{children:"Weight / % 1RM"}),t.jsx("span",{className:"text-right",children:"Actions"})]}),n.map((o,l)=>t.jsxs("div",{className:"grid grid-cols-[60px_110px_minmax(0,_1fr)_70px] items-center gap-3",children:[t.jsx("div",{className:"px-3 py-2 text-center font-semibold text-slate-600",children:o.set}),t.jsx(D,{type:"number",min:0,value:o.reps??"",onChange:i=>mt(s,l,"reps",i.target.value)}),t.jsx(D,{placeholder:"e.g. 95 or 75%",value:o.load??"",onChange:i=>mt(s,l,"load",i.target.value)}),t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[l===n.length-1&&t.jsx("button",{type:"button",onClick:()=>os(s,l+1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-100",title:"Add set",children:t.jsx(ne,{size:14})}),n.length>1&&t.jsx("button",{type:"button",onClick:()=>ds(s,l),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-rose-50",title:"Remove set",children:t.jsx(ze,{size:14})})]})]},`${e.id}-set-${l}`))]})})()]},e.id)),k.measurement_type&&t.jsx("p",{className:"text-xs text-rose-600",children:k.measurement_type[0]}),k.measurement&&t.jsx("p",{className:"text-xs text-rose-600",children:k.measurement[0]})]}):null,t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Athlete notes",t.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",rows:3,value:x.athleteNotes,onChange:e=>f(s=>({...s,athleteNotes:e.target.value}))})]}),t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Coach notes",t.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",rows:3,value:x.coachNotes,onChange:e=>f(s=>({...s,coachNotes:e.target.value}))})]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(O,{type:"button",onClick:Re,disabled:ae,children:"Cancel"}),t.jsx(O,{type:"submit",disabled:ae,className:"bg-slate-900 text-white hover:bg-slate-800",children:ae?"Saving…":"Save workout"})]})]})]})}),st&&t.jsx(Le,{open:st,onClose:()=>me(!1),title:"Create program",children:t.jsxs("form",{className:"space-y-4",onSubmit:Kt,children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Name",t.jsx(D,{className:"mt-1",value:Te.name,onChange:e=>Ee(s=>({...s,name:e.target.value})),required:!0})]}),t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Description",t.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",rows:3,value:Te.description,onChange:e=>Ee(s=>({...s,description:e.target.value}))})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(O,{type:"button",onClick:()=>me(!1),children:"Cancel"}),t.jsx(O,{type:"submit",className:"bg-slate-900 text-white hover:bg-slate-800",children:"Create program"})]})]})})]})}export{Xs as default};
