import{r as a,j as t,a as u,i as B}from"./app-BPwyOtwv.js";import{C as h}from"./Card-CgvE_g0M.js";import{T as F}from"./Table-CbgC9pMU.js";import{B as g}from"./Badge-BLy6uCaQ.js";import{B as S}from"./Button-CvcUjvH4.js";/* empty css            */function I(){const[N,C]=a.useState([]),[w,_]=a.useState(""),[n,p]=a.useState(null),[x,k]=a.useState("We opened a spot for tonight—want it?"),[o,i]=a.useState([]),[b,E]=a.useState("Logged RPE 7/10"),[f,y]=a.useState(""),[j,O]=a.useState("outcome"),[R,d]=a.useState(!0),[v,l]=a.useState(null);a.useEffect(()=>{const e=new AbortController;async function s(c=""){try{d(!0);const r=c?`/coach/overview?class_type=${encodeURIComponent(c)}`:"/coach/overview",m=await u(r,{signal:e.signal});if(e.signal.aborted)return;C(m.data.class_types??[]),p(m.data.roster),i([]),l(null)}catch(r){if(B(r)||e.signal.aborted)return;l(r instanceof Error?r.message:"Failed to load coach console")}finally{e.signal.aborted||d(!1)}}return s(),()=>{e.abort(),i([])}},[]);async function T(e){_(e);try{d(!0);const s=e?`/coach/overview?class_type=${encodeURIComponent(e)}`:"/coach/overview",c=await u(s);p(c.data.roster),i([])}catch(s){l(s instanceof Error?s.message:"Failed to load roster")}finally{d(!1)}}async function L(){if(o.length!==0)try{await u("/coach/nudges",{method:"POST",body:JSON.stringify({member_ids:o,channel:"sms",body:x})}),i([])}catch(e){l(e instanceof Error?e.message:"Failed to send nudge")}}return t.jsxs("div",{className:"grid gap-6",children:[t.jsxs(h,{title:"Roster heatmap",subtitle:"Sort by program/class",children:[t.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[t.jsxs("select",{className:"border rounded-lg px-3 py-2",value:w,onChange:e=>T(e.target.value),children:[t.jsx("option",{value:"",children:"All classes"}),N.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]}),t.jsx("div",{className:"flex gap-2 text-sm text-slate-500",children:Object.entries((n==null?void 0:n.heatmap)??{}).map(([e,s])=>t.jsxs("span",{children:[e,": ",s]},e))})]}),t.jsx(F,{cols:[{key:"select",header:"",render:(e,s)=>t.jsx("input",{type:"checkbox",checked:o.includes(s.member_id),onChange:c=>i(r=>c.target.checked?[...r,s.member_id]:r.filter(m=>m!==s.member_id))})},{key:"name",header:"Member"},{key:"class_type",header:"Class"},{key:"risk_band",header:"Risk",render:e=>e==="High"?t.jsx(g,{tone:"bad",children:"High"}):e==="Med"?t.jsx(g,{tone:"warn",children:"Med"}):t.jsx(g,{tone:"good",children:"Low"})},{key:"starts_at",header:"Next session"}],rows:((n==null?void 0:n.members)??[]).map(e=>({...e,starts_at:e.starts_at?new Date(e.starts_at).toLocaleString():"—"})),loading:R})]}),t.jsx(h,{title:"Quick nudge",subtitle:"Send a personal note",children:t.jsxs("div",{className:"grid gap-3",children:[t.jsx("textarea",{className:"border rounded-lg px-3 py-2",rows:3,value:x,onChange:e=>k(e.target.value)}),t.jsxs("div",{className:"flex justify-between items-center text-sm text-slate-500",children:[t.jsxs("span",{children:[o.length," members selected"]}),t.jsx(S,{type:"button",onClick:L,disabled:o.length===0,children:"Send SMS"})]})]})}),t.jsx(h,{title:"Log outcome",subtitle:"Track PRs, adherence, RPE",children:t.jsxs("form",{className:"grid md:grid-cols-3 gap-3",onSubmit:async e=>{if(e.preventDefault(),o.length===0){l("Select at least one member to log an outcome.");return}try{await u(`/coach/members/${o[0]}/outcomes`,{method:"POST",body:JSON.stringify({title:b,description:f,type:j})}),y("")}catch(s){l(s instanceof Error?s.message:"Failed to log outcome")}},children:[t.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Outcome title",value:b,onChange:e=>E(e.target.value),required:!0}),t.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Notes",value:f,onChange:e=>y(e.target.value)}),t.jsxs("select",{className:"border rounded-lg px-3 py-2",value:j,onChange:e=>O(e.target.value),children:[t.jsx("option",{value:"outcome",children:"Outcome"}),t.jsx("option",{value:"goal",children:"Goal"})]}),t.jsxs("div",{className:"md:col-span-3 flex justify-between items-center text-sm text-slate-500",children:[t.jsx("span",{children:o[0]?`Logging for ${o[0]}`:"Select a member above"}),t.jsx(S,{type:"submit",disabled:o.length===0,children:"Log entry"})]})]})}),v&&t.jsx("div",{className:"text-sm text-red-600",children:v})]})}export{I as default};
