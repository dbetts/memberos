import{c as A,r as i,j as s,a as L,i as I}from"./app-D8iT2tzN.js";import{C as h}from"./Card-Dbv6updy.js";import{B as d}from"./Badge-Bil8OKbm.js";import{T as g}from"./Table-BCfVrJIm.js";import{B as M}from"./Button-CbkwZXlE.js";import{S as o}from"./SelectInput-DSfljg_A.js";import{L as F}from"./ChartCard-BUrwZi_h.js";/* empty css            *//**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=A("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),R=[{month:"Jan",retained:93,joins:380,churn:7},{month:"Feb",retained:94,joins:410,churn:6},{month:"Mar",retained:94,joins:422,churn:6},{month:"Apr",retained:95,joins:450,churn:5},{month:"May",retained:95,joins:470,churn:5},{month:"Jun",retained:97,joins:520,churn:3}],B=[{id:"C-101",name:"Power Cycle",start:"06:00",capacity:24,booked:23,waitlist:2},{id:"C-225",name:"HIIT 45",start:"07:00",capacity:18,booked:16,waitlist:0},{id:"C-338",name:"Reformer Pilates",start:"08:00",capacity:12,booked:12,waitlist:4},{id:"C-441",name:"Strength Lab",start:"09:00",capacity:20,booked:18,waitlist:1}];function D(){const[b,v]=i.useState([]),[y,k]=i.useState([]),[_,m]=i.useState(!0),[x,u]=i.useState(null),[a,N]=i.useState(null),[l,j]=i.useState({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""});i.useEffect(()=>{const e=new AbortController;async function n(){try{m(!0);const t=new URLSearchParams;Object.entries(l).forEach(([S,p])=>{p&&t.append(S,p)});const w=t.toString()?`?${t.toString()}`:"",c=await L(`/dashboard/overview${w}`,{signal:e.signal});if(e.signal.aborted)return;N(c.data.filters),v(c.data.kpis??[]),k(c.data.at_risk??[]),u(null)}catch(t){if(I(t)||e.signal.aborted)return;u(t instanceof Error?t.message:"Failed to load dashboard")}finally{e.signal.aborted||m(!1)}}return n(),()=>e.abort()},[l]);const f=i.useMemo(()=>e=>e>=70?"High":e>=40?"Med":"Low",[]);function r(e,n){j(t=>({...t,[e]:n}))}function C(){j({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""})}return s.jsxs("div",{className:"grid gap-6",children:[s.jsxs(h,{title:"Segments",subtitle:"Filter KPIs by cohort",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[s.jsxs("label",{className:"text-xs text-slate-500",children:["Location",s.jsxs(o,{className:"mt-1",value:l.location_id,onChange:e=>r("location_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.locations.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Class type",s.jsxs(o,{className:"mt-1",value:l.class_type,onChange:e=>r("class_type",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.class_types.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Plan",s.jsxs(o,{className:"mt-1",value:l.plan_id,onChange:e=>r("plan_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.plans.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Instructor",s.jsxs(o,{className:"mt-1",value:l.instructor_id,onChange:e=>r("instructor_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.instructors.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Lead source",s.jsxs(o,{className:"mt-1",value:l.source,onChange:e=>r("source",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.sources.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Join month",s.jsxs(o,{className:"mt-1",value:l.join_month,onChange:e=>r("join_month",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.join_months.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(M,{type:"button",onClick:C,children:"Clear filters"})})]}),s.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:b.map(e=>s.jsxs("div",{className:"card p-5",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-slate-500 text-sm",children:e.label}),s.jsx("span",{title:e.delta?`${e.delta} ${e.good?"improvement":"decline"}`:"",children:s.jsx(E,{size:14,className:"text-slate-400"})})]}),s.jsxs("div",{className:"mt-2 flex items-end justify-between",children:[s.jsx("div",{className:"text-2xl font-semibold",children:e.value}),e.delta&&s.jsxs(d,{tone:e.good?"good":"bad",children:[e.delta," ",e.good?"vs last mo":"worse"]})]})]},e.key))}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[s.jsx("div",{className:"xl:col-span-2",children:s.jsx(F,{data:R})}),s.jsx(h,{title:"Today's classes",subtitle:"Capacity & waitlist",children:s.jsx(g,{cols:[{key:"name",header:"Class"},{key:"start",header:"Start"},{key:"capacity",header:"Capacity"},{key:"booked",header:"Booked",render:(e,n)=>s.jsxs("span",{children:[e," / ",n.capacity]})},{key:"waitlist",header:"Waitlist",render:e=>e>0?s.jsx(d,{tone:"warn",children:e}):s.jsx("span",{className:"text-slate-500",children:"—"})}],rows:B})})]}),s.jsxs(h,{title:"At‑risk members",subtitle:"Churn risk & reasons",children:[x&&s.jsx("div",{className:"text-sm text-red-600 mb-3",children:x}),s.jsx(g,{cols:[{key:"name",header:"Name"},{key:"lastCheckIn",header:"Last check‑in"},{key:"risk",header:"Risk",render:e=>e==="High"?s.jsx(d,{tone:"bad",children:"High"}):e==="Med"?s.jsx(d,{tone:"warn",children:"Med"}):s.jsx(d,{tone:"good",children:"Low"})},{key:"reason",header:"Why"}],rows:y.map(e=>{var n,t;return{id:e.member_id,name:e.member.name,lastCheckIn:e.member.last_check_in_days!==null?`${e.member.last_check_in_days} days`:"No check-ins",risk:f(e.score),reason:((t=(n=e.reasons)==null?void 0:n[0])==null?void 0:t.detail)??""}}),loading:_})]})]})}export{D as default};
