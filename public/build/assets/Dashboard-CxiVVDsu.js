import{c as S,r as n,j as s,a as A,i as L}from"./app-BzCcNu4h.js";import{C as c}from"./Card-BGbA43Lx.js";import{B as o}from"./Badge-CdBGc4ym.js";import{T as p}from"./Table-D-wG83a6.js";import{B as I}from"./Button-Di7O5-Un.js";import{L as M}from"./ChartCard-DzujzRlO.js";/* empty css            *//**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=S("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),E=[{month:"Jan",retained:93,joins:380,churn:7},{month:"Feb",retained:94,joins:410,churn:6},{month:"Mar",retained:94,joins:422,churn:6},{month:"Apr",retained:95,joins:450,churn:5},{month:"May",retained:95,joins:470,churn:5},{month:"Jun",retained:97,joins:520,churn:3}],R=[{id:"C-101",name:"Power Cycle",start:"06:00",capacity:24,booked:23,waitlist:2},{id:"C-225",name:"HIIT 45",start:"07:00",capacity:18,booked:16,waitlist:0},{id:"C-338",name:"Reformer Pilates",start:"08:00",capacity:12,booked:12,waitlist:4},{id:"C-441",name:"Strength Lab",start:"09:00",capacity:20,booked:18,waitlist:1}];function q(){const[g,b]=n.useState([]),[y,v]=n.useState([]),[k,h]=n.useState(!0),[m,x]=n.useState(null),[a,f]=n.useState(null),[l,u]=n.useState({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""});n.useEffect(()=>{const e=new AbortController;async function r(){try{h(!0);const t=new URLSearchParams;Object.entries(l).forEach(([C,j])=>{j&&t.append(C,j)});const w=t.toString()?`?${t.toString()}`:"",d=await A(`/dashboard/overview${w}`,{signal:e.signal});if(e.signal.aborted)return;f(d.data.filters),b(d.data.kpis??[]),v(d.data.at_risk??[]),x(null)}catch(t){if(L(t)||e.signal.aborted)return;x(t instanceof Error?t.message:"Failed to load dashboard")}finally{e.signal.aborted||h(!1)}}return r(),()=>e.abort()},[l]);const _=n.useMemo(()=>e=>e>=70?"High":e>=40?"Med":"Low",[]);function i(e,r){u(t=>({...t,[e]:r}))}function N(){u({location_id:"",class_type:"",instructor_id:"",plan_id:"",source:"",join_month:""})}return s.jsxs("div",{className:"grid gap-6",children:[s.jsxs(c,{title:"Segments",subtitle:"Filter KPIs by cohort",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[s.jsxs("label",{className:"text-xs text-slate-500",children:["Location",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.location_id,onChange:e=>i("location_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.locations.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Class type",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.class_type,onChange:e=>i("class_type",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.class_types.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Plan",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.plan_id,onChange:e=>i("plan_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.plans.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Instructor",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.instructor_id,onChange:e=>i("instructor_id",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.instructors.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Lead source",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.source,onChange:e=>i("source",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.sources.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("label",{className:"text-xs text-slate-500",children:["Join month",s.jsxs("select",{className:"mt-1 w-full border rounded-lg px-3 py-2",value:l.join_month,onChange:e=>i("join_month",e.target.value),children:[s.jsx("option",{value:"",children:"All"}),a==null?void 0:a.join_months.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(I,{type:"button",onClick:N,children:"Clear filters"})})]}),s.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:g.map(e=>s.jsxs("div",{className:"card p-5",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-slate-500 text-sm",children:e.label}),s.jsx("span",{title:e.delta?`${e.delta} ${e.good?"improvement":"decline"}`:"",children:s.jsx(F,{size:14,className:"text-slate-400"})})]}),s.jsxs("div",{className:"mt-2 flex items-end justify-between",children:[s.jsx("div",{className:"text-2xl font-semibold",children:e.value}),e.delta&&s.jsxs(o,{tone:e.good?"good":"bad",children:[e.delta," ",e.good?"vs last mo":"worse"]})]})]},e.key))}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[s.jsx("div",{className:"xl:col-span-2",children:s.jsx(M,{data:E})}),s.jsx(c,{title:"Today's classes",subtitle:"Capacity & waitlist",children:s.jsx(p,{cols:[{key:"name",header:"Class"},{key:"start",header:"Start"},{key:"capacity",header:"Capacity"},{key:"booked",header:"Booked",render:(e,r)=>s.jsxs("span",{children:[e," / ",r.capacity]})},{key:"waitlist",header:"Waitlist",render:e=>e>0?s.jsx(o,{tone:"warn",children:e}):s.jsx("span",{className:"text-slate-500",children:"—"})}],rows:R})})]}),s.jsxs(c,{title:"At‑risk members",subtitle:"Churn risk & reasons",children:[m&&s.jsx("div",{className:"text-sm text-red-600 mb-3",children:m}),s.jsx(p,{cols:[{key:"name",header:"Name"},{key:"lastCheckIn",header:"Last check‑in"},{key:"risk",header:"Risk",render:e=>e==="High"?s.jsx(o,{tone:"bad",children:"High"}):e==="Med"?s.jsx(o,{tone:"warn",children:"Med"}):s.jsx(o,{tone:"good",children:"Low"})},{key:"reason",header:"Why"}],rows:y.map(e=>{var r,t;return{id:e.member_id,name:e.member.name,lastCheckIn:e.member.last_check_in_days!==null?`${e.member.last_check_in_days} days`:"No check-ins",risk:_(e.score),reason:((t=(r=e.reasons)==null?void 0:r[0])==null?void 0:t.detail)??""}}),loading:k})]})]})}export{q as default};
