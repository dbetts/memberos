import{r as o,j as e,a as d,i as T}from"./app-Ca5saH2H.js";import{C as c}from"./Card-D83dShKm.js";import{T as m}from"./Table-qyxYoc6p.js";import{B as x}from"./Button-DTE-fA5O.js";/* empty css            */function z(){const[y,p]=o.useState([]),[w,u]=o.useState(!0),[h,n]=o.useState(null),[i,b]=o.useState(null),[N,f]=o.useState(!1),[l,r]=o.useState({first_name:"",last_name:"",email:"",phone:"",timezone:"",portal_email:"",portal_password:""}),[j,g]=o.useState(null),v=typeof window<"u"&&window.location?`${window.location.origin}/public/leads`:"/public/leads";o.useEffect(()=>{const t=new AbortController;async function a(){try{u(!0);const s=await d("/crm/overview",{signal:t.signal});if(t.signal.aborted)return;p(s.data.leads??[]),b(s.data.analytics??null),n(null)}catch(s){if(T(s)||t.signal.aborted)return;n(s instanceof Error?s.message:"Failed to load leads")}finally{t.signal.aborted||u(!1)}}return a(),()=>t.abort()},[]);async function _(t){try{await d(`/crm/leads/${t}/convert`,{method:"POST"}),p(s=>s.filter(L=>L.id!==t));const a=await d("/crm/analytics");b(a.data??null)}catch(a){n(a instanceof Error?a.message:"Conversion failed")}}async function C(t){var a;t.preventDefault(),n(null),g(null);try{const s=await d("/members",{method:"POST",body:JSON.stringify(l)});g((a=s.data.credentials)!=null&&a.temp_password?`Member created. Temporary password: ${s.data.credentials.temp_password}`:"Member created."),r({first_name:"",last_name:"",email:"",phone:"",timezone:"",portal_email:"",portal_password:""})}catch(s){n(s instanceof Error?s.message:"Failed to create member")}}function k(){window.open("/public/leads","_blank","noopener,noreferrer")}function S(){navigator.clipboard&&navigator.clipboard.writeText(v).then(()=>{f(!0),setTimeout(()=>f(!1),2e3)})}return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(c,{title:"Lead capture form",subtitle:"Share this public link with prospects",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Submissions go straight into the pipeline below."}),e.jsx("code",{className:"mt-2 inline-flex rounded-2xl bg-slate-100 px-3 py-1 text-sm text-slate-700",children:v})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(x,{type:"button",onClick:k,children:"Open form"}),e.jsx("button",{type:"button",onClick:S,className:"inline-flex items-center rounded-2xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-50",children:"Copy link"})]})]}),N&&e.jsx("p",{className:"mt-2 text-xs text-emerald-600",children:"Copied! Paste it into your marketing pages."})]}),e.jsx(c,{title:"Add member manually",subtitle:"One-off enrollments with optional portal login",children:e.jsxs("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:C,children:[e.jsxs("label",{className:"text-sm",children:["First name",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.first_name,onChange:t=>r(a=>({...a,first_name:t.target.value})),required:!0})]}),e.jsxs("label",{className:"text-sm",children:["Last name",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.last_name,onChange:t=>r(a=>({...a,last_name:t.target.value})),required:!0})]}),e.jsxs("label",{className:"text-sm",children:["Email",e.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.email,onChange:t=>r(a=>({...a,email:t.target.value})),placeholder:"Optional"})]}),e.jsxs("label",{className:"text-sm",children:["Phone",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.phone,onChange:t=>r(a=>({...a,phone:t.target.value})),placeholder:"+1 (555) 555-0123"})]}),e.jsxs("label",{className:"text-sm",children:["Timezone",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.timezone,onChange:t=>r(a=>({...a,timezone:t.target.value})),placeholder:"Defaults to org timezone"})]}),e.jsxs("label",{className:"text-sm",children:["Portal email",e.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.portal_email,onChange:t=>r(a=>({...a,portal_email:t.target.value})),placeholder:"Creates login if provided"})]}),e.jsxs("label",{className:"text-sm",children:["Portal password",e.jsx("input",{type:"password",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.portal_password,onChange:t=>r(a=>({...a,portal_password:t.target.value})),placeholder:"Leave blank to auto-generate"})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-3",children:[e.jsx(x,{type:"submit",children:"Create member"}),j&&e.jsx("span",{className:"text-sm text-emerald-600",children:j})]})]})}),i&&e.jsxs(c,{title:"Funnel",subtitle:"Lead quality & throughput",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total leads"}),e.jsx("div",{className:"text-2xl font-semibold",children:i.overview.total})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Lead → Trial"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[i.overview.lead_to_trial,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Trial → Join"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[i.overview.trial_to_join,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Closed"}),e.jsx("div",{className:"text-2xl font-semibold",children:i.overview.close})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By source"}),e.jsx(m,{cols:[{key:"source",header:"Source"},{key:"total",header:"Leads"},{key:"lead_to_trial",header:"Lead→Trial %"},{key:"trial_to_join",header:"Trial→Join %"}],rows:Object.entries(i.sources).map(([t,a])=>({source:t,total:a.total,lead_to_trial:`${a.lead_to_trial}%`,trial_to_join:`${a.trial_to_join}%`}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By location"}),e.jsx(m,{cols:[{key:"location",header:"Location"},{key:"total",header:"Leads"},{key:"conversion",header:"Conversion %"}],rows:Object.entries(i.locations).map(([t,a])=>({location:t,total:a.total,conversion:`${a.conversion}%`}))})]})]})]}),e.jsxs(c,{title:"Pipeline",subtitle:"Lead → Trial → Close",children:[h&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:h}),e.jsx(m,{cols:[{key:"name",header:"Lead"},{key:"stage",header:"Stage"},{key:"source",header:"Source"},{key:"updated_at",header:"Updated"},{key:"actions",header:"",render:(t,a)=>e.jsx(x,{type:"button",onClick:()=>_(a.id),children:"Convert"})}],rows:y.map(t=>({...t,name:`${t.first_name} ${t.last_name}`,updated_at:new Date(t.updated_at).toLocaleString()})),loading:w})]})]})}export{z as default};
