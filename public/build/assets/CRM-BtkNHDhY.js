import{r as i,j as e,a as n}from"./app-KmpLvqco.js";import{C as c}from"./Card-CN1EV_ID.js";import{T as x}from"./Table-HJjVJUeR.js";import{B as p}from"./Button-C0QuDMMl.js";/* empty css            */function $(){const[w,u]=i.useState([]),[N,h]=i.useState(!0),[b,d]=i.useState(null),[o,f]=i.useState(null),[_,j]=i.useState(!1),[l,r]=i.useState({first_name:"",last_name:"",email:"",phone:"",timezone:"",portal_email:"",portal_password:""}),[v,g]=i.useState(null),y=typeof window<"u"&&window.location?`${window.location.origin}/public/leads`:"/public/leads";i.useEffect(()=>{let a=!0;async function t(){try{h(!0);const[s,m]=await Promise.all([n("/crm/leads"),n("/crm/analytics")]);if(!a)return;u(s.data??[]),f(m.data??null)}catch(s){if(!a)return;d(s instanceof Error?s.message:"Failed to load leads")}finally{a&&h(!1)}}return t(),()=>{a=!1}},[]);async function C(a){try{await n(`/crm/leads/${a}/convert`,{method:"POST"}),u(s=>s.filter(m=>m.id!==a));const t=await n("/crm/analytics");f(t.data??null)}catch(t){d(t instanceof Error?t.message:"Conversion failed")}}async function k(a){var t;a.preventDefault(),d(null),g(null);try{const s=await n("/members",{method:"POST",body:JSON.stringify(l)});g((t=s.data.credentials)!=null&&t.temp_password?`Member created. Temporary password: ${s.data.credentials.temp_password}`:"Member created."),r({first_name:"",last_name:"",email:"",phone:"",timezone:"",portal_email:"",portal_password:""})}catch(s){d(s instanceof Error?s.message:"Failed to create member")}}function S(){window.open("/public/leads","_blank","noopener,noreferrer")}function L(){navigator.clipboard&&navigator.clipboard.writeText(y).then(()=>{j(!0),setTimeout(()=>j(!1),2e3)})}return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(c,{title:"Lead capture form",subtitle:"Share this public link with prospects",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Submissions go straight into the pipeline below."}),e.jsx("code",{className:"mt-2 inline-flex rounded-2xl bg-slate-100 px-3 py-1 text-sm text-slate-700",children:y})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(p,{type:"button",onClick:S,children:"Open form"}),e.jsx("button",{type:"button",onClick:L,className:"inline-flex items-center rounded-2xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-50",children:"Copy link"})]})]}),_&&e.jsx("p",{className:"mt-2 text-xs text-emerald-600",children:"Copied! Paste it into your marketing pages."})]}),e.jsx(c,{title:"Add member manually",subtitle:"One-off enrollments with optional portal login",children:e.jsxs("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:k,children:[e.jsxs("label",{className:"text-sm",children:["First name",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.first_name,onChange:a=>r(t=>({...t,first_name:a.target.value})),required:!0})]}),e.jsxs("label",{className:"text-sm",children:["Last name",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.last_name,onChange:a=>r(t=>({...t,last_name:a.target.value})),required:!0})]}),e.jsxs("label",{className:"text-sm",children:["Email",e.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.email,onChange:a=>r(t=>({...t,email:a.target.value})),placeholder:"Optional"})]}),e.jsxs("label",{className:"text-sm",children:["Phone",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.phone,onChange:a=>r(t=>({...t,phone:a.target.value})),placeholder:"+1 (555) 555-0123"})]}),e.jsxs("label",{className:"text-sm",children:["Timezone",e.jsx("input",{className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.timezone,onChange:a=>r(t=>({...t,timezone:a.target.value})),placeholder:"Defaults to org timezone"})]}),e.jsxs("label",{className:"text-sm",children:["Portal email",e.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.portal_email,onChange:a=>r(t=>({...t,portal_email:a.target.value})),placeholder:"Creates login if provided"})]}),e.jsxs("label",{className:"text-sm",children:["Portal password",e.jsx("input",{type:"password",className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2",value:l.portal_password,onChange:a=>r(t=>({...t,portal_password:a.target.value})),placeholder:"Leave blank to auto-generate"})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-3",children:[e.jsx(p,{type:"submit",children:"Create member"}),v&&e.jsx("span",{className:"text-sm text-emerald-600",children:v})]})]})}),o&&e.jsxs(c,{title:"Funnel",subtitle:"Lead quality & throughput",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total leads"}),e.jsx("div",{className:"text-2xl font-semibold",children:o.overview.total})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Lead → Trial"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[o.overview.lead_to_trial,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Trial → Join"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[o.overview.trial_to_join,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Closed"}),e.jsx("div",{className:"text-2xl font-semibold",children:o.overview.close})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By source"}),e.jsx(x,{cols:[{key:"source",header:"Source"},{key:"total",header:"Leads"},{key:"lead_to_trial",header:"Lead→Trial %"},{key:"trial_to_join",header:"Trial→Join %"}],rows:Object.entries(o.sources).map(([a,t])=>({source:a,total:t.total,lead_to_trial:`${t.lead_to_trial}%`,trial_to_join:`${t.trial_to_join}%`}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By location"}),e.jsx(x,{cols:[{key:"location",header:"Location"},{key:"total",header:"Leads"},{key:"conversion",header:"Conversion %"}],rows:Object.entries(o.locations).map(([a,t])=>({location:a,total:t.total,conversion:`${t.conversion}%`}))})]})]})]}),e.jsxs(c,{title:"Pipeline",subtitle:"Lead → Trial → Close",children:[b&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:b}),e.jsx(x,{cols:[{key:"name",header:"Lead"},{key:"stage",header:"Stage"},{key:"source",header:"Source"},{key:"updated_at",header:"Updated"},{key:"actions",header:"",render:(a,t)=>e.jsx(p,{type:"button",onClick:()=>C(t.id),children:"Convert"})}],rows:w.map(a=>({...a,name:`${a.first_name} ${a.last_name}`,updated_at:new Date(a.updated_at).toLocaleString()})),loading:N})]})]})}export{$ as default};
