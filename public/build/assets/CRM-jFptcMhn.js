import{r as i,j as e}from"./app-Dr9nHl9w.js";import{C as u,T as d,a as r}from"./client-Co9KTTQ3.js";import{B as f}from"./Button-BBD2kbOS.js";/* empty css            */function b(){const[v,n]=i.useState([]),[j,c]=i.useState(!0),[m,x]=i.useState(null),[a,h]=i.useState(null);i.useEffect(()=>{let s=!0;async function t(){try{c(!0);const[l,o]=await Promise.all([r("/crm/leads"),r("/crm/analytics")]);if(!s)return;n(l.data??[]),h(o.data??null)}catch(l){if(!s)return;x(l instanceof Error?l.message:"Failed to load leads")}finally{s&&c(!1)}}return t(),()=>{s=!1}},[]);async function y(s){try{await r(`/crm/leads/${s}/convert`,{method:"POST"}),n(l=>l.filter(o=>o.id!==s));const t=await r("/crm/analytics");h(t.data??null)}catch(t){x(t instanceof Error?t.message:"Conversion failed")}}return e.jsxs("div",{className:"grid gap-6",children:[a&&e.jsxs(u,{title:"Funnel",subtitle:"Lead quality & throughput",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total leads"}),e.jsx("div",{className:"text-2xl font-semibold",children:a.overview.total})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Lead → Trial"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[a.overview.lead_to_trial,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Trial → Join"}),e.jsxs("div",{className:"text-2xl font-semibold",children:[a.overview.trial_to_join,"%"]})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Closed"}),e.jsx("div",{className:"text-2xl font-semibold",children:a.overview.close})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By source"}),e.jsx(d,{cols:[{key:"source",header:"Source"},{key:"total",header:"Leads"},{key:"lead_to_trial",header:"Lead→Trial %"},{key:"trial_to_join",header:"Trial→Join %"}],rows:Object.entries(a.sources).map(([s,t])=>({source:s,total:t.total,lead_to_trial:`${t.lead_to_trial}%`,trial_to_join:`${t.trial_to_join}%`}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 mb-2",children:"By location"}),e.jsx(d,{cols:[{key:"location",header:"Location"},{key:"total",header:"Leads"},{key:"conversion",header:"Conversion %"}],rows:Object.entries(a.locations).map(([s,t])=>({location:s,total:t.total,conversion:`${t.conversion}%`}))})]})]})]}),e.jsxs(u,{title:"Pipeline",subtitle:"Lead → Trial → Close",children:[m&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:m}),e.jsx(d,{cols:[{key:"name",header:"Lead"},{key:"stage",header:"Stage"},{key:"source",header:"Source"},{key:"updated_at",header:"Updated"},{key:"actions",header:"",render:(s,t)=>e.jsx(f,{type:"button",onClick:()=>y(t.id),children:"Convert"})}],rows:v.map(s=>({...s,name:`${s.first_name} ${s.last_name}`,updated_at:new Date(s.updated_at).toLocaleString()})),loading:j})]})]})}export{b as default};
