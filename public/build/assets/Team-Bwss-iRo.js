import{r,j as a,a as o,i as D}from"./app-D8iT2tzN.js";import{C as x}from"./Card-Dbv6updy.js";import{B as V}from"./Button-CbkwZXlE.js";import{T as F}from"./Table-BCfVrJIm.js";import{T as k}from"./TextInput-DSljf_rU.js";import{S as w}from"./SelectInput-DSfljg_A.js";/* empty css            */const p=[{slug:"admin",label:"Admin"},{slug:"coach",label:"Coach"},{slug:"support",label:"Support"}],J=[{key:"billing.manage",label:"Manage billing & payments"},{key:"billing.read",label:"View billing"},{key:"members.manage",label:"Manage members"},{key:"members.read",label:"View members"},{key:"communications.manage",label:"Email/SMS automations"},{key:"communications.read",label:"View messaging"},{key:"workouts.manage",label:"Workout builder"},{key:"workouts.read",label:"View workouts"},{key:"analytics.manage",label:"Reporting & insights"}];function H(){const[S,c]=r.useState([]),[d,h]=r.useState([]),[E,b]=r.useState(!0),[f,i]=r.useState(null),[C,y]=r.useState(!1),[u,g]=r.useState({name:"",email:"",role_slug:"coach"}),[j,_]=r.useState(null),[T,N]=r.useState(null);r.useEffect(()=>{const e=new AbortController;async function s(){try{b(!0);const[t,l]=await Promise.all([o("/team/users",{signal:e.signal}),o("/roles",{signal:e.signal})]);if(e.signal.aborted)return;c(t.data),h(l.data),i(null)}catch(t){if(D(t)||e.signal.aborted)return;i(t instanceof Error?t.message:"Unable to load team")}finally{e.signal.aborted||b(!1)}}return s(),()=>e.abort()},[]);async function P(e){e.preventDefault();try{y(!0);const s=await o("/team/users",{method:"POST",body:JSON.stringify(u)});c(t=>[...t,s.data.user]),_(s.data.temp_password),g({name:"",email:"",role_slug:"coach"})}catch(s){i(s instanceof Error?s.message:"Unable to create user")}finally{y(!1)}}async function R(e,s){try{const t=await o(`/team/users/${e}`,{method:"PUT",body:JSON.stringify({role_slug:s})});c(l=>l.map(n=>n.id===e?{...n,role_slug:t.data.role_slug}:n))}catch(t){i(t instanceof Error?t.message:"Unable to update role")}}async function U(e){if(confirm("Remove this team member?"))try{await o(`/team/users/${e}`,{method:"DELETE"}),c(s=>s.filter(t=>t.id!==e))}catch(s){i(s instanceof Error?s.message:"Unable to remove user")}}async function M(e,s,t){try{N(e);const l=d.find(m=>m.id===e);if(!l)return;const n=t?Array.from(new Set([...l.permissions??[],s])):(l.permissions??[]).filter(m=>m!==s),L=await o(`/roles/${e}`,{method:"PUT",body:JSON.stringify({permissions:n,name:l.name})});h(m=>m.map(v=>v.id===e?L.data:v))}catch(l){i(l instanceof Error?l.message:"Unable to update permissions")}finally{N(null)}}const A=r.useMemo(()=>d.reduce((e,s)=>(e[s.slug]=s.permissions??[],e),{}),[d]);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs(x,{title:"Team",subtitle:"Invite admins, coaches, and support roles",children:[a.jsxs("form",{className:"grid gap-4 md:grid-cols-4",onSubmit:P,children:[a.jsxs("label",{className:"text-sm",children:["Full name",a.jsx(k,{className:"mt-1",value:u.name,onChange:e=>g(s=>({...s,name:e.target.value})),required:!0})]}),a.jsxs("label",{className:"text-sm",children:["Email",a.jsx(k,{type:"email",className:"mt-1",value:u.email,onChange:e=>g(s=>({...s,email:e.target.value})),required:!0})]}),a.jsxs("label",{className:"text-sm",children:["Role",a.jsx(w,{className:"mt-1",value:u.role_slug,onChange:e=>g(s=>({...s,role_slug:e.target.value})),children:p.map(e=>a.jsx("option",{value:e.slug,children:e.label},e.slug))})]}),a.jsx("div",{className:"flex items-end",children:a.jsx(V,{type:"submit",disabled:C,children:"Add member"})})]}),j&&a.jsxs("p",{className:"mt-4 rounded-xl bg-slate-50 px-4 py-3 text-sm text-slate-600",children:["Temporary password: ",a.jsx("span",{className:"font-semibold text-slate-900",children:j})]})]}),a.jsxs(x,{title:"Team directory",subtitle:"Manage access for staff and contractors",children:[E?a.jsx("p",{className:"text-sm text-slate-500",children:"Loading…"}):a.jsx(F,{cols:[{key:"name",header:"Name"},{key:"email",header:"Email"},{key:"role",header:"Role",render:(e,s)=>a.jsx(w,{className:"w-auto rounded-lg px-2 py-1 text-sm",value:s.role_slug,onChange:t=>R(s.id,t.target.value),children:p.map(t=>a.jsx("option",{value:t.slug,children:t.label},t.slug))})},{key:"last_login_at",header:"Last active",render:e=>e?new Date(e).toLocaleString():"—"},{key:"actions",header:"",render:(e,s)=>s.is_primary_owner?a.jsx("span",{className:"text-xs font-medium text-slate-400",children:"Primary owner"}):a.jsx("button",{type:"button",onClick:()=>U(s.id),className:"text-sm text-rose-600 hover:underline",children:"Remove"})}],rows:S.map(e=>({...e,role:e.role_slug}))}),f&&a.jsx("p",{className:"mt-4 text-sm text-rose-600",children:f})]}),a.jsx(x,{title:"Role permissions",subtitle:"Customize what each role can access",children:a.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:p.map(e=>{const s=d.find(l=>l.slug===e.slug);if(!s)return null;const t=A[s.slug]??[];return a.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-slate-900",children:e.label}),a.jsx("p",{className:"text-xs text-slate-500",children:s.name})]}),T===s.id&&a.jsx("span",{className:"text-xs text-slate-400",children:"Saving…"})]}),a.jsx("div",{className:"mt-3 space-y-2 text-sm text-slate-600",children:J.map(l=>a.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",children:[a.jsx("input",{type:"checkbox",checked:t.includes(l.key),onChange:n=>M(s.id,l.key,n.target.checked)}),l.label]},l.key))})]},e.slug)})})})]})}export{H as default};
