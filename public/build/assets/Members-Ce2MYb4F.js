import{r as i,j as e,a as L,i as C}from"./app-CkmwQ5Pl.js";import{C as b}from"./Card-huvhWaid.js";import{B as o}from"./Button-BBzaGNvL.js";import{B as P}from"./Badge-CVi-YSRS.js";import{T as F}from"./TextInput-CcTkSXZv.js";import{S as R}from"./SelectInput-CyF3PkuI.js";/* empty css            */function g(d,h="USD"){return d==null?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:h}).format(d/100)}function K(){var M;const[d,h]=i.useState([]),[c,E]=i.useState({current_page:1,last_page:1,total:0}),[U,N]=i.useState(!0),[f,p]=i.useState(null),[y,$]=i.useState(""),[r,m]=i.useState({page:1,perPage:25,search:"",sort:"name",direction:"asc"}),[t,j]=i.useState(null),[u,_]=i.useState(null),[v,w]=i.useState(!1);i.useEffect(()=>{const s=new AbortController;async function a(){try{N(!0);const l=new URLSearchParams({page:String(r.page),per_page:String(r.perPage),sort:r.sort,direction:r.direction});r.search&&l.append("search",r.search);const n=await L(`/members?${l.toString()}`,{signal:s.signal});if(s.signal.aborted)return;h(n.data??[]),E({current_page:n.current_page,last_page:n.last_page,total:n.total}),p(null)}catch(l){if(C(l)||s.signal.aborted)return;p(l instanceof Error?l.message:"Failed to load members")}finally{s.signal.aborted||N(!1)}}return a(),()=>s.abort()},[r]),i.useEffect(()=>{if(!u)return;const s=new AbortController;async function a(){try{w(!0);const l=await L(`/members/${u}`,{signal:s.signal});if(s.signal.aborted)return;j(l.data)}catch(l){if(C(l)||s.signal.aborted)return;p(l instanceof Error?l.message:"Unable to load member detail")}finally{s.signal.aborted||w(!1)}}return a(),()=>s.abort()},[u]);const S=i.useMemo(()=>s=>r.sort===s?r.direction==="asc"?"▲":"▼":void 0,[r.sort,r.direction]);function k(){m(s=>({...s,page:1,search:y.trim()}))}function A(s){m(a=>({...a,page:1,sort:s,direction:a.sort===s&&a.direction==="asc"?"desc":"asc"}))}function D(s){m(a=>{const l=a.page+s;return l<1||l>c.last_page?a:{...a,page:l}})}return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(b,{title:"Members",subtitle:"Full roster",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsx(F,{type:"search",value:y,onChange:s=>$(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),k())},placeholder:"Search name, email, or phone",className:"w-full text-sm"}),e.jsx(o,{type:"button",onClick:k,children:"Search"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["Rows",e.jsx(R,{value:r.perPage,onChange:s=>m(a=>({...a,perPage:Number(s.target.value),page:1})),className:"w-auto rounded-lg px-2 py-1 text-sm",children:[15,25,50,100].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-y-2",children:[e.jsx("thead",{children:e.jsx("tr",{children:[{key:"name",label:"Member"},{key:"contact",label:"Contact"},{key:"status",label:"Status"},{key:"plan",label:"Plan"},{key:"joined_on",label:"Joined"},{key:"risk",label:"Risk"},{key:"actions",label:""}].map(s=>e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:["contact","actions"].includes(s.key)?s.label:e.jsxs("button",{type:"button",onClick:()=>A(s.key),className:"inline-flex items-center gap-1 text-slate-600",children:[s.label,S(s.key)&&e.jsx("span",{className:"text-[10px] text-slate-400",children:S(s.key)})]})},s.key))})}),e.jsx("tbody",{children:U?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-3 py-6 text-center text-sm text-slate-500",children:"Loading members…"})}):d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-3 py-6 text-center text-sm text-slate-500",children:"No members match your filters."})}):d.map(s=>{var a,l;return e.jsxs("tr",{className:"rounded-2xl border border-slate-100 bg-white/90 text-sm text-slate-700 shadow-sm backdrop-blur",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:`${s.first_name} ${s.last_name}`}),e.jsxs("div",{className:"text-xs text-slate-500",children:["ID: ",s.id]})]}),e.jsxs("td",{className:"px-3 py-3 text-sm text-slate-600",children:[e.jsx("div",{children:s.email??"—"}),e.jsx("div",{className:"text-xs text-slate-500",children:s.phone??""})]}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(P,{children:s.status})}),e.jsx("td",{className:"px-3 py-3",children:((a=s.membership_plan)==null?void 0:a.name)??"—"}),e.jsx("td",{className:"px-3 py-3",children:s.joined_on?new Date(s.joined_on).toLocaleDateString():"—"}),e.jsx("td",{className:"px-3 py-3",children:typeof((l=s.risk_score)==null?void 0:l.score)=="number"?e.jsx(P,{tone:s.risk_score.score>=70?"bad":s.risk_score.score>=40?"warn":"good",children:s.risk_score.score}):e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(o,{type:"button",onClick:()=>{j(null),_(s.id)},children:"View"})})]},s.id)})})]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3 text-sm text-slate-500",children:[e.jsxs("div",{children:["Page ",c.current_page," of ",c.last_page," · ",c.total," total"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{type:"button",onClick:()=>D(-1),disabled:c.current_page<=1,children:"Previous"}),e.jsx(o,{type:"button",onClick:()=>D(1),disabled:c.current_page>=c.last_page,children:"Next"})]})]}),f&&e.jsx("p",{className:"mt-3 text-sm text-rose-600",children:f})]}),v&&e.jsx(b,{title:"Loading member profile",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Fetching latest activity…"})}),t&&!v&&e.jsxs(b,{title:`${t.member.first_name} ${t.member.last_name}`,subtitle:"Member profile and history",children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx(o,{type:"button",onClick:()=>{j(null),_(null)},children:"Close"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("p",{className:"text-slate-900 font-semibold",children:"Contact"}),e.jsxs("p",{children:["Email: ",t.member.email??"—"]}),e.jsxs("p",{children:["Phone: ",t.member.phone??"—"]}),e.jsxs("p",{children:["Timezone: ",t.member.timezone??"Org default"]}),e.jsxs("p",{children:["Preferred channel: ",t.member.preferred_contact_channel??"Not set"]}),e.jsxs("p",{children:["Home location: ",((M=t.member.home_location)==null?void 0:M.name)??"—"]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("p",{className:"text-slate-900 font-semibold",children:"Membership"}),e.jsxs("p",{children:["Plan: ",t.billing.plan_name??"—"]}),e.jsxs("p",{children:["Amount:"," ",t.billing.amount_cents?g(t.billing.amount_cents,t.billing.currency??"USD"):"—",t.billing.interval?` / ${t.billing.interval}`:""]}),e.jsxs("p",{children:["Status: ",t.billing.status??"—"]}),e.jsxs("p",{children:["Next bill:"," ",t.billing.next_due_on?new Date(t.billing.next_due_on).toLocaleDateString():"—"]})]})]}),e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Lifetime value"}),e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:g(t.metrics.lifetime_value_cents)})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Avg classes / week"}),e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:t.metrics.avg_classes_per_week})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Check-ins"}),e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:t.metrics.total_check_ins})]}),e.jsxs("div",{className:"glass p-4",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Last visit"}),e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:t.metrics.last_check_in?new Date(t.metrics.last_check_in).toLocaleDateString():"—"})]})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Payment history"}),e.jsxs("table",{className:"min-w-full border-separate border-spacing-y-2 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-slate-500",children:[e.jsx("th",{className:"px-2 py-1",children:"Due"}),e.jsx("th",{className:"px-2 py-1",children:"Amount"}),e.jsx("th",{className:"px-2 py-1",children:"Status"}),e.jsx("th",{className:"px-2 py-1",children:"Plan"})]})}),e.jsx("tbody",{children:t.payments.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-2 py-3 text-slate-500",children:"No payments yet."})}):t.payments.map(s=>{var a;return e.jsxs("tr",{className:"rounded-lg border border-slate-100 bg-white shadow-sm",children:[e.jsx("td",{className:"px-2 py-2",children:s.due_on?new Date(s.due_on).toLocaleDateString():"—"}),e.jsx("td",{className:"px-2 py-2",children:g(s.amount_cents,s.currency??"USD")}),e.jsx("td",{className:"px-2 py-2 capitalize",children:s.status}),e.jsx("td",{className:"px-2 py-2",children:((a=s.membership_plan)==null?void 0:a.name)??"—"})]},s.id)})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Insights"}),e.jsx("div",{className:"space-y-3 text-sm text-slate-600",children:t.insights.map(s=>e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50/70 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:s.label}),e.jsx("div",{className:"font-semibold text-slate-900",children:s.value}),e.jsx("div",{className:"text-xs text-slate-500",children:s.detail})]},s.label))})]})]}),e.jsxs("div",{className:"mt-6 grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Upcoming classes"}),t.upcoming_sessions.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No future bookings."}):e.jsx("ul",{className:"space-y-2 text-sm text-slate-600",children:t.upcoming_sessions.map(s=>{var a,l,n,x;return e.jsxs("li",{className:"rounded-2xl border border-slate-100 bg-white p-3 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:((a=s.session)==null?void 0:a.class_type)??"Session"}),e.jsx("div",{children:(l=s.session)!=null&&l.starts_at?new Date(s.session.starts_at).toLocaleString():"—"}),e.jsx("div",{className:"text-xs text-slate-500",children:((x=(n=s.session)==null?void 0:n.location)==null?void 0:x.name)??"—"})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Recent classes"}),t.recent_sessions.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No recent attendance."}):e.jsx("ul",{className:"space-y-2 text-sm text-slate-600",children:t.recent_sessions.map(s=>{var a,l,n,x;return e.jsxs("li",{className:"rounded-2xl border border-slate-100 bg-white p-3 shadow-sm",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:((a=s.session)==null?void 0:a.class_type)??"Session"}),e.jsx("div",{children:(l=s.session)!=null&&l.starts_at?new Date(s.session.starts_at).toLocaleString():"—"}),e.jsx("div",{className:"text-xs text-slate-500",children:((x=(n=s.session)==null?void 0:n.location)==null?void 0:x.name)??"—"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Status: ",s.status]})]},s.id)})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Check-ins"}),t.check_ins.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No check-ins recorded."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-y-2 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-slate-500",children:[e.jsx("th",{className:"px-2 py-1",children:"Date"}),e.jsx("th",{className:"px-2 py-1",children:"Location"}),e.jsx("th",{className:"px-2 py-1",children:"Method"})]})}),e.jsx("tbody",{children:t.check_ins.map(s=>{var a;return e.jsxs("tr",{className:"rounded-lg border border-slate-100 bg-white shadow-sm",children:[e.jsx("td",{className:"px-2 py-2",children:s.checked_in_at?new Date(s.checked_in_at).toLocaleString():"—"}),e.jsx("td",{className:"px-2 py-2",children:((a=s.location)==null?void 0:a.name)??"—"}),e.jsx("td",{className:"px-2 py-2",children:s.method??"—"})]},s.id)})})]})})]})]})]})}export{K as default};
