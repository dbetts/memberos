import{r as a,j as e,T as Ne}from"./app-C2cRDrk6.js";import{C as u,T as g,a as r}from"./client-C_H5CMFT.js";import{B as m}from"./Button-Dyjvqw8_.js";import{B as P}from"./Badge-CbVuks5E.js";/* empty css            */const Se={locations:[{name:"Downtown Studio",timezone:"America/Los_Angeles",capacity:30}],plans:[{name:"Unlimited",external_id:"UNLIMITED",price_cents:18900,currency:"USD"}],members:[{first_name:"Jordan",last_name:"Lee",email:"jordan@example.com",phone:"+14155550123",status:"active",joined_on:"2024-05-01",plan_external_id:"UNLIMITED",home_location:"Downtown Studio",tags:["streak-break"]}]};function De(){const[ie,B]=a.useState([]),[$,Q]=a.useState(null),[f,H]=a.useState(null),[h,K]=a.useState(!0),[W,d]=a.useState(null),[Y,D]=a.useState(!0),[G,E]=a.useState("21:00"),[V,M]=a.useState("08:00"),[X,O]=a.useState(3),[Z,R]=a.useState(12),[ee,F]=a.useState("member_preference"),[q,N]=a.useState(null),[le,S]=a.useState(!1),[oe,w]=a.useState([]),[de,te]=a.useState([]),[ce,me]=a.useState([]),[p,k]=a.useState({name:"",description:"",default_capacity:""}),[ue,pe]=a.useState([]),[xe,se]=a.useState([]),[A,z]=a.useState({title:"",body:""}),[C,he]=a.useState(null),[ye,ae]=a.useState([]),[v,j]=a.useState({domain:"",spf_record:"",dkim_selector:"",dkim_value:""}),[ge,ne]=a.useState([]),[I,J]=a.useState({brand_name:"",campaign_name:""});a.useEffect(()=>{let t=!0;async function s(){try{K(!0);const[n,i,L,x,l,b,y,o,_,T,be]=await Promise.all([r("/integrations"),r("/communications/policy"),r("/security/mfa/preferences"),r("/admin/locations"),r("/admin/class-types"),r("/admin/staff"),r("/observability/events"),r("/observability/release-notes"),r("/observability/slo"),r("/compliance/domains"),r("/compliance/sms")]);if(!t)return;B(n.data??[]),Q(i.data??null),H(L.data??null);const c=i.data??null;D((c==null?void 0:c.enforce_stop_keywords)??!0),c&&(E(c.quiet_hours_start),M(c.quiet_hours_end),O(c.default_daily_cap),R(c.default_weekly_cap),F(c.timezone_strategy));const _e=(x.data??[]).map(U=>({...U,hoursText:JSON.stringify(U.hours??{mon:"06:00-20:00"},null,2),depositText:JSON.stringify(U.deposit_policy??{amount:0},null,2)}));w(_e),te(l.data??[]),me(b.data??[]),pe(y.data??[]),se(o.data??[]),he(_.data??null),ae(T.data??[]),ne(be.data??[])}catch(n){if(!t)return;d(n instanceof Error?n.message:"Failed to load settings")}finally{t&&K(!1)}}return s(),()=>{t=!1}},[]);async function fe(){try{await r("/integrations/mindbody/import",{method:"POST",body:JSON.stringify(Se)});const t=await r("/integrations");B(t.data??[])}catch(t){d(t instanceof Error?t.message:"Import failed")}}async function ve(t){if(t.preventDefault(),t.stopPropagation(),!$)return;const s=x=>{const l=x.trim(),b=l.match(/^(\d{1,2}):([0-5]\d)(?::([0-5]\d))?$/);if(b){const o=b[1].padStart(2,"0"),_=b[2];return Number(o)>23?null:`${o}:${_}`}const y=l.match(/^(\d{1,2}):([0-5]\d)\s*(AM|PM)$/i);if(y){let o=Number(y[1]);const _=y[2],T=y[3].toUpperCase();return o===12?o=T==="AM"?0:12:T==="PM"&&(o+=12),o>23?null:`${o.toString().padStart(2,"0")}:${_}`}return null},n=s(G),i=s(V);if(!n||!i){S(!1),N("Quiet hours must be in HH:MM (24-hour) or h:mm AM/PM format.");return}N(null),S(!1);const L={quiet_hours_start:n,quiet_hours_end:i,default_daily_cap:X,default_weekly_cap:Z,timezone_strategy:ee,enforce_stop_keywords:Y};try{const l=(await r("/communications/policy",{method:"PUT",body:JSON.stringify(L)})).data;Q(l),E(l.quiet_hours_start),M(l.quiet_hours_end),O(l.default_daily_cap),R(l.default_weekly_cap),F(l.timezone_strategy),D(l.enforce_stop_keywords),S(!0)}catch(x){S(!1),x instanceof Error?N(x.message):N("Failed to update policy")}}async function re(t){try{const s=await r("/security/mfa/preferences",{method:"PUT",body:JSON.stringify({preference:t,enabled:!0})});H(s.data)}catch(s){d(s instanceof Error?s.message:"Failed to update MFA preferences")}}async function je(t){d(null);try{const s={hours:t.hoursText?JSON.parse(t.hoursText):void 0,deposit_policy:t.depositText?JSON.parse(t.depositText):void 0,cancellation_window_minutes:t.cancellation_window_minutes};await r(`/admin/locations/${t.id}`,{method:"PUT",body:JSON.stringify(s)})}catch(s){d(s instanceof Error?s.message:"Failed to update location")}}return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(u,{title:"Integrations",subtitle:"Connect your stack",children:[W&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:W}),e.jsx(g,{cols:[{key:"provider",header:"Provider"},{key:"status",header:"Status",render:t=>t==="connected"?e.jsx(P,{tone:"good",children:"Connected"}):e.jsx(P,{children:t})},{key:"last_synced_at",header:"Last synced"}],rows:ie.map(t=>({...t,last_synced_at:t.last_synced_at??"Never"})),loading:h}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(m,{onClick:fe,children:"Run Mindbody mock import"})})]}),$&&e.jsx(u,{title:"Communication policy",subtitle:"Quiet hours & send caps",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("label",{className:"text-sm",children:["Quiet hours start",e.jsx("input",{name:"quiet_hours_start",type:"time",value:G,className:"mt-1 w-full border rounded-lg px-3 py-2",onChange:t=>E(t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:["Quiet hours end",e.jsx("input",{name:"quiet_hours_end",type:"time",value:V,className:"mt-1 w-full border rounded-lg px-3 py-2",onChange:t=>M(t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:["Daily send cap",e.jsx("input",{name:"daily_cap",type:"number",min:0,value:X,className:"mt-1 w-full border rounded-lg px-3 py-2",onChange:t=>O(Number(t.target.value))})]}),e.jsxs("label",{className:"text-sm",children:["Weekly send cap",e.jsx("input",{name:"weekly_cap",type:"number",min:0,value:Z,className:"mt-1 w-full border rounded-lg px-3 py-2",onChange:t=>R(Number(t.target.value))})]}),e.jsxs("label",{className:"text-sm",children:["Timezone strategy",e.jsxs("select",{name:"timezone",value:ee,className:"mt-1 w-full border rounded-lg px-3 py-2",onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"member_preference",children:"Member timezone"}),e.jsx("option",{value:"organization",children:"Organization timezone"})]})]}),e.jsxs("div",{className:"text-sm flex items-center justify-between border rounded-lg px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Respect STOP keywords"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Required for SMS compliance (STOP, UNSUBSCRIBE, CANCEL)"})]}),e.jsx(Ne,{checked:Y,onChange:D})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx(m,{type:"button",onClick:ve,children:"Save policy"})}),q&&e.jsx("div",{className:"md:col-span-2 text-sm text-red-600",children:q}),le&&!q&&e.jsx("div",{className:"md:col-span-2 text-sm text-emerald-600",children:"Policy updated."})]})}),f&&e.jsxs(u,{title:"Multi-factor authentication",subtitle:"Encourage authenticator apps for staff",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Preferred method"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Authenticator apps provide stronger security than SMS. SMS remains available for convenience."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{tone:f.preference==="totp"?"primary":"neutral",onClick:()=>re("totp"),children:"Authenticator app"}),e.jsx(m,{tone:f.preference==="sms"?"primary":"neutral",onClick:()=>re("sms"),children:"SMS backup"})]})]}),e.jsxs("div",{className:"mt-4 text-xs text-slate-500",children:["Registered methods: ",f.methods.length===0?"none":f.methods.map(t=>t.type).join(", ")]})]}),e.jsx(u,{title:"Locations",subtitle:"Hours, deposits, cancellation",children:e.jsx("div",{className:"space-y-4",children:oe.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-xs text-slate-500",children:"Cancellation window (minutes)"})]}),e.jsx("input",{type:"number",className:"w-28 border rounded-lg px-2 py-1 text-sm",value:t.cancellation_window_minutes,onChange:s=>w(n=>n.map(i=>i.id===t.id?{...i,cancellation_window_minutes:Number(s.target.value)}:i))})]}),e.jsxs("label",{className:"text-xs text-slate-500",children:["Hours JSON",e.jsx("textarea",{className:"mt-1 w-full border rounded-lg px-2 py-1 text-xs",rows:3,value:t.hoursText??"",onChange:s=>w(n=>n.map(i=>i.id===t.id?{...i,hoursText:s.target.value}:i))})]}),e.jsxs("label",{className:"text-xs text-slate-500",children:["Deposit policy JSON",e.jsx("textarea",{className:"mt-1 w-full border rounded-lg px-2 py-1 text-xs",rows:2,value:t.depositText??"",onChange:s=>w(n=>n.map(i=>i.id===t.id?{...i,depositText:s.target.value}:i))})]}),e.jsx("div",{className:"text-right",children:e.jsx(m,{type:"button",onClick:()=>je(t),children:"Save"})})]},t.id))})}),e.jsxs(u,{title:"Class types",subtitle:"Programs & capacities",children:[e.jsxs("form",{className:"grid md:grid-cols-3 gap-3",onSubmit:async t=>{t.preventDefault();try{const s={name:p.name,description:p.description||void 0,default_capacity:p.default_capacity?Number(p.default_capacity):void 0},n=await r("/admin/class-types",{method:"POST",body:JSON.stringify(s)});te(i=>[...i,n.data]),k({name:"",description:"",default_capacity:""})}catch(s){d(s instanceof Error?s.message:"Failed to add class type")}},children:[e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Name",value:p.name,onChange:t=>k(s=>({...s,name:t.target.value})),required:!0}),e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Description",value:p.description,onChange:t=>k(s=>({...s,description:t.target.value}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border rounded-lg px-3 py-2 flex-1",placeholder:"Capacity",value:p.default_capacity,onChange:t=>k(s=>({...s,default_capacity:t.target.value}))}),e.jsx(m,{type:"submit",children:"Add"})]})]}),e.jsx(g,{cols:[{key:"name",header:"Name"},{key:"description",header:"Description"},{key:"default_capacity",header:"Cap"}],rows:de,loading:h})]}),e.jsx(u,{title:"Staff & instructors",subtitle:"Roles, bios, certifications",children:e.jsx(g,{cols:[{key:"name",header:"Name"},{key:"title",header:"Title"},{key:"location",header:"Home location"},{key:"instructor",header:"Instructor"}],rows:ce.map(t=>{var s,n;return{id:t.id,name:((s=t.user)==null?void 0:s.name)??"Unknown",title:t.title??"—",location:((n=t.primary_location)==null?void 0:n.name)??"All",instructor:t.is_instructor?e.jsx(P,{tone:"good",children:"Yes"}):e.jsx(P,{children:"No"})}}),loading:h})}),e.jsx(u,{title:"Observability",subtitle:"Events & release notes",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700 mb-2",children:"Recent events"}),C&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm text-slate-800 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"API p95"}),e.jsxs("div",{className:"font-semibold",children:[C.api_p95_ms??"–"," ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"UI p95"}),e.jsxs("div",{className:"font-semibold",children:[C.web_p95_ms??"–"," ms"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Uptime"}),e.jsxs("div",{className:"font-semibold",children:[C.uptime_percent??"–","%"]})]})]}),e.jsx(g,{cols:[{key:"event_type",header:"Type"},{key:"severity",header:"Severity"},{key:"created_at",header:"When"}],rows:ue.map(t=>({...t,created_at:new Date(t.created_at).toLocaleString()})),loading:h})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700 mb-2",children:"Release notes"}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{t.preventDefault();try{const s=await r("/observability/release-notes",{method:"POST",body:JSON.stringify(A)});se(n=>[s.data,...n]),z({title:"",body:""})}catch(s){d(s instanceof Error?s.message:"Failed to publish note")}},children:[e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Title",value:A.title,onChange:t=>z(s=>({...s,title:t.target.value})),required:!0}),e.jsx("textarea",{className:"border rounded-lg px-3 py-2",rows:3,placeholder:"Body",value:A.body,onChange:t=>z(s=>({...s,body:t.target.value})),required:!0}),e.jsx(m,{type:"submit",children:"Publish"})]}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-slate-700",children:xe.map(t=>e.jsxs("li",{className:"border rounded-lg px-3 py-2 bg-slate-50",children:[e.jsx("div",{className:"font-semibold",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:t.published_at?new Date(t.published_at).toLocaleDateString():"Draft"})]},t.id))})]})]})}),e.jsx(u,{title:"Compliance",subtitle:"Domain auth & SMS registrations",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("form",{className:"grid md:grid-cols-4 gap-3",onSubmit:async t=>{t.preventDefault();try{const s=await r("/compliance/domains",{method:"POST",body:JSON.stringify(v)});ae(n=>[...n,s.data]),j({domain:"",spf_record:"",dkim_selector:"",dkim_value:""})}catch(s){d(s instanceof Error?s.message:"Failed to add domain")}},children:[e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Domain",value:v.domain,onChange:t=>j(s=>({...s,domain:t.target.value})),required:!0}),e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"SPF record",value:v.spf_record,onChange:t=>j(s=>({...s,spf_record:t.target.value}))}),e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"DKIM selector",value:v.dkim_selector,onChange:t=>j(s=>({...s,dkim_selector:t.target.value}))}),e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"DKIM value",value:v.dkim_value,onChange:t=>j(s=>({...s,dkim_value:t.target.value}))}),e.jsx("div",{className:"md:col-span-4 flex justify-end",children:e.jsx(m,{type:"submit",children:"Add domain"})})]}),e.jsx(g,{cols:[{key:"domain",header:"Domain"},{key:"status",header:"Status"},{key:"spf_record",header:"SPF"}],rows:ye,loading:h}),e.jsxs("form",{className:"grid md:grid-cols-3 gap-3",onSubmit:async t=>{t.preventDefault();try{const s=await r("/compliance/sms",{method:"POST",body:JSON.stringify(I)});ne(n=>[...n,s.data]),J({brand_name:"",campaign_name:""})}catch(s){d(s instanceof Error?s.message:"Failed to add registration")}},children:[e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Brand name",value:I.brand_name,onChange:t=>J(s=>({...s,brand_name:t.target.value})),required:!0}),e.jsx("input",{className:"border rounded-lg px-3 py-2",placeholder:"Campaign name",value:I.campaign_name,onChange:t=>J(s=>({...s,campaign_name:t.target.value})),required:!0}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(m,{type:"submit",children:"Add campaign"})})]}),e.jsx(g,{cols:[{key:"brand_name",header:"Brand"},{key:"campaign_name",header:"Campaign"},{key:"status",header:"Status"}],rows:ge,loading:h})]})})]})}export{De as default};
